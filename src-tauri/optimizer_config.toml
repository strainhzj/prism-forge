# PrismForge 优化器配置文件
# 此文件控制 "Analyze & Generate Prompt" 功能的提示词生成行为

# ==================== Meta-Prompt 模板 ====================
[meta_prompt]
# 默认 Meta-Prompt 模板，用于指导 LLM 生成优化后的提示词
# 这个模板会被注入到每个提示词生成请求中
# 可用变量: {{goal}}, {{sessions}}, {{context}}
template = "你是一个专业的编程助手提示词优化器。基于以下信息，生成一个清晰、具体的提示词，帮助用户高效完成编程任务。\n\n## 你的任务\n1. 分析用户的编程目标\n2. 参考相关历史会话中的解决方案\n3. 生成一个可直接使用的、结构化的提示词\n\n## 输出格式\n请生成一个包含以下部分的提示词：\n1. **任务背景**: 简要描述要完成的任务\n2. **技术要求**: 涉及的技术栈和约束条件\n3. **参考方案**: 基于历史经验的建议\n4. **具体步骤**: 明确的实施步骤\n5. **预期输出**: 期望的结果格式\n\n## 限制条件\n- 提示词要简洁明了（控制在 500 字以内）\n- 优先参考高评分、高相似度的历史方案\n- 突出关键技术点和注意事项"

# ==================== LLM 调用参数 ====================
[llm_params]
# 温度参数：控制输出随机性
# - 0.0: 完全确定性输出，适合需要精确答案的场景
# - 0.3-0.7: 平衡创造性和一致性，推荐范围
# - 1.0: 高度创造性，可能产生多样化结果
temperature = 0.3

# 最大生成 Token 数
# - 建议: 1000-2000，取决于提示词复杂度
# - 过低: 可能截断输出
# - 过高: 浪费 Token 和时间
max_tokens = 1500

# Top-P 采样参数（核采样）
# - 0.9: 推荐，在保持质量的同时提供多样性
# - 1.0: 不启用核采样
top_p = 0.9

# 频率惩罚：减少重复内容
# - 0.0: 不惩罚
# - 0.5-1.0: 中等惩罚，避免重复
frequency_penalty = 0.0

# 存在惩罚：鼓励谈论新话题
# - 0.0: 不惩罚
# - 0.5-1.0: 中等惩罚，鼓励多样性
presence_penalty = 0.0

# ==================== 提示词结构模板 ====================
[prompt_structure]
# 完整提示词的组装结构
# 可用变量:
#   {{meta_prompt}}: Meta-Prompt 模板内容
#   {{goal}}: 用户输入的目标
#   {{sessions}}: 格式化的会话列表
#   {{context}}: 压缩后的上下文摘要
structure = "{{meta_prompt}}\n\n## 用户目标\n{{goal}}\n\n## 相关历史会话\n{{sessions}}\n\n## 上下文摘要\n{{context}}\n\n## 请求\n基于上述信息，生成一个优化的提示词。"

# ==================== 回退模板 ====================
[fallback]
# 当没有相关会话时使用的简单模板
# 可用变量: {{goal}}
no_sessions_template = "请帮我完成以下编程任务：\n\n{{goal}}\n\n请提供详细的实现方案和代码示例。"

# LLM 调用失败时使用的模板
# 可用变量: {{goal}}, {{best_session_summary}}, {{best_session_rating}}
llm_error_template = '请帮我完成以下编程任务：\n\n{{goal}}\n\n{{#if best_session_summary}}## 参考\n相关会话: (评分: {{best_session_rating}})\n{{best_session_summary}}{{/if}}\n\n请提供详细的实现方案和代码示例。'

# 对话开始模板（当会话消息为空时使用）
# 可用变量: {{goal}}
conversation_starter_template = "你是一个专业的提示词专家。用户想要在ai coding agent开始一个新的对话，请生成一段信噪比的提示词来帮助用户开始对话。\n\n## 用户目标\n{{goal}}\n\n## 要求\n1. 理解用户的目标\n2. 补充用户目标中可能缺失的部分\n3. 提供明确的方向\n4. 保持简洁明了（控制在 200 字以内）\n\n请生成一个对话开始的提示词。"

# ==================== 会话上下文配置 ====================
[session_context]
# 会话信息格式化配置

# 摘要最大长度（字符数）
# - 限制过短: 可能丢失重要信息
# - 限制过长: 可能超出上下文窗口
max_summary_length = 200

# 是否包含评分信息
include_rating = true

# 是否包含项目名称
include_project = true

# 会话列表格式模板
# 可用变量: {{session_id}}, {{project_name}}, {{rating}}, {{summary}}
session_format = "- 会话 {{session_id}} {{#if project_name}}(项目: {{project_name}}){{/if}} {{#if rating}}(评分: {{rating}}){{/if}}:\n  {{summary}}"

# ==================== 上下文压缩配置 ====================
[compression]
# 压缩策略配置

# 压缩级别: "none", "basic", "aggressive"
# - none: 不压缩，保留原始内容
# - basic: 基础压缩，去除冗余（推荐）
# - aggressive: 激进压缩，最小化内容
level = "basic"

# 是否保留 Markdown 格式
preserve_formatting = true

# 最小压缩比例（0.0-1.0）
# - 0.0: 不保证压缩
# - 0.5: 至少压缩 50%
min_compression_ratio = 0.0

# ==================== 高级设置 ====================
[advanced]
# 并行会话处理数量
parallel_processing = 5

# 缓存策略: "none", "memory", "disk"
cache_strategy = "memory"

# 调试模式：输出详细日志
debug = false

# 超时时间（秒）
timeout = 30

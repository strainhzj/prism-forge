# 会话管理原型示意图

> **功能**: 监控目录会话管理
> **日期**: 2025-01-09

---

## 🎨 原型示意

### **初始状态**

```
┌────────────────────────────────────────────────────────┐
│ ← 返回    会话管理                      🌙 主题切换    │
│           浏览和管理 Claude Code 会话历史              │
├──────────────────────┬─────────────────────────────────┤
│ 📁 监控目录            │                                 │
│                      │         📂                       │
│ [添加目录] [刷新]     │    请选择一个监控目录            │
│                      │                                 │
│                      │  从左侧列表中选择一个目录查看     │
│                      │  其会话文件                      │
│                      │                                 │
│                      │                                 │
│                      │                                 │
│                      │                                 │
└──────────────────────┴─────────────────────────────────┘
```

---

### **添加目录**

```
┌────────────────────────────────────────────────────────┐
│                    添加监控目录                         │
├────────────────────────────────────────────────────────┤
│                                                        │
│  确认要添加此目录到监控列表吗？应用将扫描该目录下的     │
│  所有会话文件。                                         │
│                                                        │
│  ──────────────────────────────────────────────────  │
│                                                        │
│  名称:         [__________项目名称__________]         │
│                                                        │
│  路径:         [C:\software\Java\project    ]         │
│                (只读)                                  │
│                                                        │
│  ──────────────────────────────────────────────────  │
│                                                        │
│              [取消]               [添加]              │
└────────────────────────────────────────────────────────┘
```

---

### **目录列表状态**

```
┌────────────────────────────────────────────────────────┐
│ ← 返回    会话管理                      🌙 主题切换    │
├──────────────────────┬─────────────────────────────────┤
│ 📁 监控目录            │  📝 我的项目                     │
│                      │  C:\software\Java\project       │
│ [添加目录] [刷新]     │                                 │
│                      │  15 个会话                       │
│ 📦 我的项目 🔵        │                                 │
│ 📦 测试项目 🔵        │  ────────────────────────────── │
│ 📦 旧项目   🔵        │                                 │
│                      │  📝 2025-01-09 12:34            │
│                      │     xxx-xxx...                  │
│                      │     2.3 KB                      │
│                      │                                 │
│                      │  📝 2025-01-09 10:20            │
│                      │     xxx-xxx...                  │
│                      │     1.8 KB                      │
│                      │                                 │
│                      │  📝 2025-01-08 16:45            │
│                      │     xxx-xxx...  ★               │
│                      │     3.1 KB                      │
│                      │                                 │
│                      │  (向下滚动自动加载更多...)        │
└──────────────────────┴─────────────────────────────────┘
```

---

### **会话内容状态**

```
┌────────────────────────────────────────────────────────┐
│ ← 返回    会话管理           🔄          🌙 主题切换   │
│          xxx-xxx...                                     │
├────────────────────────────────────────────────────────┤
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ USER (12:34:56) · user_message                   │ │
│  │                                                  │ │
│  │ 请帮我实现一个用户登录功能                        │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ ASSISTANT (12:35:12) · text                      │ │
│  │                                                  │ │
│  │ 好的，我来帮你实现用户登录功能。首先，我们需要... │ │
│  │                                                  │ │
│  │ 我们可以使用 React Hook Form 来处理表单验证...   │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ USER (12:36:45) · user_message                   │ │
│  │                                                  │ │
│  │ 需要支持邮箱和手机号登录                          │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│  ┌──────────────────────────────────────────────────┐ │
│  │ ASSISTANT (12:37:20) · text                      │ │
│  │                                                  │ │
│  │ 明白了，我来修改登录表单支持多种登录方式...       │ │
│  └──────────────────────────────────────────────────┘ │
│                                                        │
│                         (向下滚动查看更多消息...)        │
│                                                        │
├────────────────────────────────────────────────────────┤
│ 共 128 条消息                                          │
└────────────────────────────────────────────────────────┘
```

---

## 🔄 用户交互流程

### **流程 1: 添加目录并查看会话**

```
1. 用户点击"添加目录"
   ↓
2. 选择本地项目路径 (C:\software\Java\project)
   ↓
3. 确认目录名称（自动填充，可修改）
   ↓
4. 点击"添加"
   ↓
5. 目录出现在左侧列表
   ↓
6. 点击目录项
   ↓
7. 右侧显示该目录的会话文件列表（按时间倒序）
```

### **流程 2: 查看会话详情**

```
1. 在会话列表中点击某个会话
   ↓
2. 右侧切换到会话内容视图
   ↓
3. 显示 Session Log 形式的对话内容
   ↓
4. 最新消息显示在最上方
   ↓
5. 点击"← 返回"回到会话列表
   或
   点击"🔄 刷新"重新加载内容
```

---

## 💡 交互亮点

### **1. 懒加载**
- 初始显示 20 条会话
- 滚动到底部自动加载更多
- 平滑的用户体验

### **2. 友好的时间显示**
```
刚刚
2分钟前
1小时前
3小时前
昨天
3天前
```

### **3. 视觉反馈**
- 🔵 蓝色文件夹图标：活跃目录
- ⭐ 星标：有评分的会话
- 🔄 刷新按钮：重新加载
- ← 返回按钮：返回上级

### **4. 响应式设计**
- 固定顶部导航栏
- 固定左侧目录列表（264px 宽）
- 右侧内容自适应

---

## 📊 数据流示意

```
用户添加目录
  ↓
保存到数据库 (MonitoredDirectory)
  ↓
用户点击目录
  ↓
前端调用 get_sessions_by_monitored_directory(monitoredPath)
  ↓
后端转换路径
  C:\software\Java\project → C--software-Java-project
  ↓
扫描 ~/.claude/projects/C--software-Java-project/
  ↓
返回 SessionFileInfo[] (按时间倒序)
  ↓
前端显示会话列表
  ↓
用户点击会话
  ↓
前端调用 parse_session_file(filePath)
  ↓
解析 .jsonl 文件
  ↓
返回 ParsedEvent[]
  ↓
前端倒序显示 (最新在最上面)
```

---

## 🎯 核心功能

✅ **目录管理**: 添加、删除、启用/禁用监控目录
✅ **路径转换**: 自动转换 Windows 路径为 Claude 项目文件夹名
✅ **会话列表**: 按修改时间倒序显示，支持懒加载
✅ **会话内容**: Session Log 形式显示，倒序排列
✅ **导航流畅**: 支持返回和刷新操作

---

**原型完成！可以开始测试实际功能。** 🚀

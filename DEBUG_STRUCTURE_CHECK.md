# ğŸ” JSONL ç»“æ„è°ƒè¯•æŒ‡å—

## é—®é¢˜:è½¬æ¢åå¾—åˆ° 0 ä¸ªæ¶ˆæ¯å¯¹è±¡

**å½“å‰çŠ¶æ€:**
- âœ… JSONL æ–‡ä»¶æˆåŠŸè§£æ(æœ‰ N ä¸ªæ¡ç›®)
- âŒ è½¬æ¢ä¸º Message å¯¹è±¡åå¾—åˆ° 0 ä¸ª

**å¯èƒ½åŸå› :**
1. JSONL æ¡ç›®ä¸­ `type` å­—æ®µä¸æ˜¯ "message"
2. JSONL æ¡ç›®ç¼ºå°‘ `uuid` å­—æ®µ
3. JSONL æ¡ç›®çš„å­—æ®µåç§°ä¸é¢„æœŸä¸ç¬¦

## æ–°å¢çš„è°ƒè¯•è¾“å‡º

é‡æ–°å¯åŠ¨åº”ç”¨å,ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡º:

```
[DEBUG] è§£æåˆ° 150 ä¸ª JSONL æ¡ç›®
[DEBUG] ç¬¬ä¸€æ¡ JSONL æ¡ç›®ç»“æ„:
  type: Some("message")
  role: Some("user")
  uuid: Some("abc123...")
  data keys: Some(["type", "uuid", "parentUuid", "timestamp", "message"])
[DEBUG] è½¬æ¢åå¾—åˆ° 0 ä¸ªæ¶ˆæ¯å¯¹è±¡ (view_level: Full)
```

**å…³é”®ä¿¡æ¯:**

### 1. `type` å­—æ®µçš„å€¼
- å¦‚æœä¸æ˜¯ `"message"`,åˆ™ä¼šè¢«è¿‡æ»¤æ‰
- Claude Code ä¼šè¯æ–‡ä»¶ä¸­å¯èƒ½æœ‰å…¶ä»–ç±»å‹,å¦‚ `"summary"`, `"history"` ç­‰

### 2. `role` å­—æ®µçš„ä½ç½®
- å¯èƒ½åœ¨é¡¶å±‚: `{"role": "user", ...}`
- å¯èƒ½åœ¨åµŒå¥—å¯¹è±¡ä¸­: `{"message": {"role": "user", ...}}`

### 3. `data keys` - æ‰€æœ‰å­—æ®µååˆ—è¡¨
è¿™ä¼šå‘Šè¯‰æˆ‘ä»¬ JSON å¯¹è±¡çš„å®Œæ•´ç»“æ„,å¸®åŠ©æˆ‘ä»¬ç†è§£æ•°æ®å¸ƒå±€

## å¦‚ä½•è¯Šæ–­

### åœºæ™¯ 1: type å­—æ®µä¸æ˜¯ "message"

**è¾“å‡ºç¤ºä¾‹:**
```
  type: Some("summary")
```

**è¯´æ˜:** ç¬¬ä¸€æ¡è®°å½•æ˜¯ summary ç±»å‹,ä¸æ˜¯æ¶ˆæ¯ç±»å‹ã€‚è¿™æ˜¯æ­£å¸¸çš„,Claude Code æ–‡ä»¶é€šå¸¸ä»¥ summary å¼€å¤´ã€‚

**è§£å†³:** æŸ¥çœ‹åç»­æ¡ç›®çš„ type,åº”è¯¥ä¼šæœ‰ "message" ç±»å‹çš„æ¡ç›®ã€‚

### åœºæ™¯ 2: uuid å­—æ®µç¼ºå¤±

**è¾“å‡ºç¤ºä¾‹:**
```
  uuid: None
  data keys: Some(["type", "timestamp", "message"])
```

**è¯´æ˜:** JSONL æ¡ç›®æ²¡æœ‰ uuid å­—æ®µ,å¯¼è‡´ `filter_map` è¿”å› Noneã€‚

**è§£å†³:** éœ€è¦ä¿®æ”¹è½¬æ¢é€»è¾‘,ä½¿ç”¨å…¶ä»–å­—æ®µä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚

### åœºæ™¯ 3: role å­—æ®µä½ç½®é”™è¯¯

**è¾“å‡ºç¤ºä¾‹:**
```
  role: None
  data keys: Some(["type", "uuid", "message"])
```

**è¯´æ˜:** role å­—æ®µä¸åœ¨é¡¶å±‚,å¯èƒ½åœ¨ `message` å¯¹è±¡å†…éƒ¨ã€‚

**JSON ç»“æ„å¯èƒ½æ˜¯:**
```json
{
  "type": "message",
  "uuid": "abc123",
  "message": {
    "role": "user",
    "content": "..."
  }
}
```

**å½“å‰ä»£ç :**
```rust
let role = entry.role().unwrap_or("unknown".to_string());
// ç­‰ä»·äº entry.data.get("role")
```

**éœ€è¦ä¿®æ”¹ä¸º:**
```rust
let role = entry.data.get("message")
    .and_then(|v| v.get("role"))
    .and_then(|v| v.as_str())
    .map(|s| s.to_string())
    .unwrap_or_else(|| "unknown".to_string());
```

## ä¸‹ä¸€æ­¥

1. **é‡æ–°å¯åŠ¨åº”ç”¨** (npm run tauri dev)
2. **æ‰“å¼€ä¼šè¯æ–‡ä»¶**
3. **æŸ¥çœ‹è°ƒè¯•è¾“å‡º**,ç‰¹åˆ«æ³¨æ„:
   - `type` çš„å€¼
   - `role` çš„å€¼
   - `data keys` åˆ—è¡¨

4. **å°†å®Œæ•´çš„è°ƒè¯•è¾“å‡ºå‘ç»™æˆ‘**,åŒ…æ‹¬æ‰€æœ‰å­—æ®µä¿¡æ¯

è¿™æ ·æˆ‘å°±èƒ½å‡†ç¡®å®šä½é—®é¢˜å¹¶ä¿®å¤è½¬æ¢é€»è¾‘! ğŸ¯

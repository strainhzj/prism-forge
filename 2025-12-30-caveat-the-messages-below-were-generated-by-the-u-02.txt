
 * â–â–›â–ˆâ–ˆâ–ˆâ–œâ–Œ *   Claude Code v2.0.75
* â–â–œâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–›â–˜ *  glm-4.7 Â· API Usage Billing
 *  â–˜â–˜ â–â–  *   C:\software\full_stack\prism-forge

  /model to try Opus 4.5

> /clear 
  â¿ Â (no content)

> è¯»å–æ–‡ä»¶ "main_plan.json" è¿›è¡Œdry-runï¼Œæ ¹æ®dty-runè¿‡ç¨‹ç€é‡å…³æ³¨wave2çš„æµç¨‹
ï¼Œåˆ†ææ˜¯å¦å­˜åœ¨æœ‰æ­§ä¹‰çš„éƒ¨åˆ†ã€ä»¥åŠè¿‡ç¨‹ä¸­æ˜¯å¦ç¼ºå°‘å¿…è¦çš„ä¿¡æ¯ 

â— æˆ‘æ¥å¸®ä½ è¯»å– main_plan.json æ–‡ä»¶å¹¶é‡ç‚¹åˆ†æ wave2 çš„ dry-run æµç¨‹ã€‚é¦–å…ˆè®©æˆ‘æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚

â— Search(pattern: "**/main_plan.json")
  â¿ Â Found 1 file (ctrl+o to expand)

â— Read(dev_plans\plan1\main_plan.json)
  â¿ Â Read 558 lines

â— ç°åœ¨è®©æˆ‘è¯»å– wave2 çš„è¯¦ç»†è®¡åˆ’æ–‡ä»¶æ¥è¿›è¡Œæ·±å…¥åˆ†æï¼š

â— Read(dev_plans\plan1\waves\wave2_phase1_core.json)
  â¿ Â Read 417 lines

â— ç°åœ¨è®©æˆ‘è¯»å–å…³é”®çš„å­ä»»åŠ¡æ–‡ä»¶æ¥è¿›è¡Œæ·±å…¥åˆ†æï¼š

â— Read(dev_plans\plan1\waves\wave2.8_prerequisites.json)
  â¿ Â Read 249 lines

â— Read(dev_plans\plan1\waves\wave2.2_task_t1_2.json)
  â¿ Â Read 287 lines

â— Read(dev_plans\plan1\waves\wave2.3_task_t1_3_v6.0.json)
  â¿ Â Read 232 lines

â— Read(dev_plans\plan1\waves\wave2.4_task_t1_perf_v4.1.json)
  â¿ Â Read 234 lines

â— è®©æˆ‘å†è¯»å–å‡ ä¸ªå…³é”®æ–‡ä»¶æ¥å®Œæˆåˆ†æï¼š

â— Read(dev_plans\plan1\waves\wave2.7_templates.json)
  â¿ Â Read 219 lines

â— Read(dev_plans\plan1\waves\wave2.5_integration_v3.1.json)
  â¿ Â Read 248 lines

â— Read(dev_plans\plan1\waves\wave2_v6_virtual_execution_report.md)
  â¿ Â Read 537 lines

â— ç°åœ¨è®©æˆ‘åŸºäºé˜…è¯»çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå…¨é¢çš„ dry-run åˆ†æï¼Œç‰¹åˆ«å…³æ³¨ wave2 çš„æµç¨‹ã€‚

  ---
  ğŸ“‹ Wave 2 Dry-Run åˆ†ææŠ¥å‘Š

  ä¸€ã€æ‰§è¡Œæµç¨‹æ¦‚è§ˆ

  æ ¹æ® wave2_phase1_core.jsonï¼ŒWave 2 çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹ï¼š

  1. T1_3: æ‰©å±•æ•°æ®åº“è¡¨ç»“æ„ (migrate_v9, v10, v11, v12)
     â””â”€ ä¼˜å…ˆçº§: high
     â””â”€ ä¾èµ–: T1_1 (Wave 1)

  2. T1_2: å®ç°ä¼šè¯æ‰«æå™¨
     â””â”€ ä¼˜å…ˆçº§: critical
     â””â”€ ä¾èµ–: T1_1, T1_3 (v5.0 å·²ä¿®å¤)

  3. T1_PERF: æ€§èƒ½åŸºå‡†æµ‹è¯•
     â””â”€ ä¼˜å…ˆçº§: medium
     â””â”€ ä¾èµ–: T1_2

  ---
  äºŒã€å‘ç°çš„æ­§ä¹‰å’Œé—®é¢˜

  ğŸ”´ ä¸¥é‡é—®é¢˜ 1: å‰ç½®æ¡ä»¶éªŒè¯ä¸­çš„é€»è¾‘çŸ›ç›¾

  ä½ç½®: wave2.8_prerequisites.json:54-64

  é—®é¢˜è¯¦æƒ…:
  // wave2.8 å£°ç§° scan_cache_enabled å­—æ®µåœ¨ Wave 1 ä¸­åˆ›å»º
  {
    "deliverable": "settings è¡¨ï¼ˆWave 2 é…ç½®ä¾èµ–ï¼‰",
    "expected_columns": ["id", "active_threshold", "scan_cache_enabled"],
    "critical_fields": [
      {
        "field": "scan_cache_enabled",
        "wave1_version": "migrate_v6 åˆ›å»º",  // âš ï¸ è¿™ä¸ wave2.3 çŸ›ç›¾ï¼
        "verification_sql": "SELECT scan_cache_enabled FROM settings WHERE id = 1;"
      }
    ]
  }

  çŸ›ç›¾åˆ†æ:
  - wave2.8 å£°ç§°å­—æ®µåœ¨ Wave 1 çš„ migrate_v6 ä¸­åˆ›å»º
  - wave2.3 (v6.0) åœ¨ Step 6 ä¸­æ·»åŠ  migrate_v12 åˆ›å»ºæ­¤å­—æ®µ
  - éªŒè¯æ£€æŸ¥ç‚¹ V_WAVE2_008 æœŸæœ› Wave 1 å®Œæˆåå°±æœ‰æ­¤å­—æ®µ

  å½±å“:
  - å¦‚æœä¸¥æ ¼æŒ‰ç…§ wave2.8 éªŒè¯ï¼ŒWave 2 æ‰§è¡Œå‰ä¼šå¤±è´¥ï¼ˆWave 1 æ²¡æœ‰æ­¤å­—æ®µï¼‰
  - å¦‚æœä¸¥æ ¼æŒ‰ç…§ wave2.3 æ‰§è¡Œï¼Œéœ€è¦é‡æ–°ç†è§£å‰ç½®æ¡ä»¶

  å»ºè®®ä¿®å¤:
  // åœ¨ wave2.8 ä¸­ä¿®æ”¹ä¸ºï¼š
  {
    "field": "scan_cache_enabled",
    "wave_version": "Wave 2 migrate_v12 åˆ›å»º (T1_3 ä»»åŠ¡)",
    "note": "æ­¤å­—æ®µå°†åœ¨ T1_3 Step 6 ä¸­åˆ›å»º",
    "verification_checkpoint": "T1_3 å®ŒæˆåéªŒè¯"
  }

  ---
  ğŸŸ  é«˜ä¼˜å…ˆçº§é—®é¢˜ 2: T1_PERF æµ‹è¯•æ•°æ®å‡†å¤‡é€»è¾‘ä¸å®Œæ•´

  ä½ç½®: wave2.4_task_t1_perf_v4.1.json:59-72

  é—®é¢˜è¯¦æƒ…:
  "_v7_0_addition": {
    "test_data_preparation": {
      "script_reference": "wave2.7_templates_v6.0.json -> T2_006 setup_test_environment()",
      "data_distribution": {
        "small_files": {"percentage": 70, "size": "<1MB"},
        "medium_files": {"percentage": 25, "size": "1-5MB"},
        "large_files": {"percentage": 5, "size": ">5MB"}
      }
    }
  }

  æ­§ä¹‰åˆ†æ:
  - T2_006 æ¨¡æ¿çš„ setup_test_environment() åªåˆ›å»º 10 ä¸ªé¡¹ç›® Ã— 10 ä¸ªä¼šè¯ = 100 ä¸ªæ–‡ä»¶
  - ä½†æ¯ä¸ªæ–‡ä»¶åªæœ‰ 10 è¡Œæ¶ˆæ¯ï¼ˆçº¦ 1KBï¼‰ï¼Œéƒ½æ˜¯"small_files"
  - æ²¡æœ‰å®ç° "medium_files" (1-5MB) å’Œ "large_files" (>5MB) çš„ç”Ÿæˆé€»è¾‘
  - æµ‹è¯•åœºæ™¯ "1000 ä¸ªä¼šè¯ï¼ˆå‹åŠ›æµ‹è¯•ï¼‰" æ²¡æœ‰å¯¹åº”çš„æµ‹è¯•æ•°æ®å‡†å¤‡ä»£ç 

  ç¼ºå¤±ä¿¡æ¯:
  1. å¦‚ä½•ç”Ÿæˆ 1-5MB çš„ä¸­å‹æ–‡ä»¶ï¼Ÿ
  2. å¦‚ä½•ç”Ÿæˆ >5MB çš„å¤§å‹æ–‡ä»¶ï¼Ÿ
  3. 1000 ä¸ªä¼šè¯çš„æµ‹è¯•æ•°æ®å¦‚ä½•å‡†å¤‡ï¼Ÿ

  å»ºè®®è¡¥å……:
  // åœ¨ T2_006 æ¨¡æ¿ä¸­æ·»åŠ ï¼š
  fn setup_large_test_file(path: PathBuf, size_mb: usize) {
      // ç”ŸæˆæŒ‡å®šå¤§å°çš„ JSONL æ–‡ä»¶
  }

  fn setup_stress_test_environment(count: usize) -> Vec<PathBuf> {
      // ç”Ÿæˆ 1000+ ä¸ªæµ‹è¯•æ–‡ä»¶
  }

  ---
  ğŸŸ  é«˜ä¼˜å…ˆçº§é—®é¢˜ 3: è·¨æ¨¡æ¿ä¾èµ–å¼•ç”¨ä¸æ˜ç¡®

  ä½ç½®: wave2.7_templates.json:72-75

  é—®é¢˜è¯¦æƒ…:
  "T2_002": {
    "dependencies": ["tauri"],
    "_v6_0_notes": {
      "note": "éœ€è¦ T2_010 (SessionRepository::upsert_session)"
    }
  }

  æ­§ä¹‰åˆ†æ:
  - T2_002 (scan_sessions å‘½ä»¤) ä¾èµ– T2_010 (upsert_session æ–¹æ³•)
  - ä½† dependencies æ•°ç»„ä¸­åªåˆ—äº† "tauri"ï¼Œæ²¡æœ‰åŒ…å« "T2_010"
  - å¼€å‘è€…å¯èƒ½ä¸çŸ¥é“éœ€è¦å…ˆå®ç° T2_010

  å»ºè®®ä¿®å¤:
  {
    "dependencies": ["tauri", "T2_010"],
    "implementation_order": "å¿…é¡»åœ¨ T2_010 ä¹‹åå®ç°"
  }

  ---
  ğŸŸ¡ ä¸­ç­‰ä¼˜å…ˆçº§é—®é¢˜ 4: ç¼“å­˜åŠŸèƒ½å®ç°é€»è¾‘ä¸å®Œæ•´

  ä½ç½®: wave2.2_task_t1_2.json:156-180

  é—®é¢˜è¯¦æƒ…:
  // wave2.2 Step 6 æä¾›äº†ç¼“å­˜ç»“æ„ä½“
  pub fn scan_session_files_incremental(cache: Option<&ScanCache>) -> Result<Vec<SessionMetadata>>

  // ä½†æ²¡æœ‰è¯´æ˜ï¼š
  // 1. ç¼“å­˜åœ¨å“ªé‡Œå­˜å‚¨ï¼Ÿå†…å­˜ï¼Ÿç£ç›˜ï¼Ÿ
  // 2. ç¼“å­˜å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ
  // 3. ç¼“å­˜ä½•æ—¶æ›´æ–°ï¼Ÿ
  // 4. is_scan_cache_enabled() å¦‚ä½•å½±å“æ‰«æé€»è¾‘ï¼Ÿ

  ç¼ºå¤±ä¿¡æ¯:
  - ç¼“å­˜çš„å­˜å‚¨ä½ç½®å’Œæ ¼å¼
  - ç¼“å­˜çš„åŠ è½½/ä¿å­˜é€»è¾‘
  - is_scan_cache_enabled() ä¸º false æ—¶çš„è¡Œä¸º
  - ç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼ˆä½•æ—¶æ¸…ç©ºç¼“å­˜ï¼‰

  å»ºè®®è¡¥å……:
  // åœ¨ wave2.2 æˆ– wave2.7 ä¸­æ·»åŠ ï¼š
  pub struct ScanCache {
      entries: HashMap<String, SystemTime>,
      file_path: PathBuf,  // æŒä¹…åŒ–è·¯å¾„
  }

  impl ScanCache {
      pub fn load() -> Result<Self> { /* ä»æ–‡ä»¶åŠ è½½ */ }
      pub fn save(&self) -> Result<()> { /* ä¿å­˜åˆ°æ–‡ä»¶ */ }
      pub fn is_enabled() -> bool { /* æ£€æŸ¥ settings */ }
  }

  ---
  ğŸŸ¡ ä¸­ç­‰ä¼˜å…ˆçº§é—®é¢˜ 5: é”™è¯¯å¤„ç†ç­–ç•¥ä¸ç»Ÿä¸€

  ä½ç½®: å¤šå¤„

  é—®é¢˜è¯¦æƒ…:
  - wave2.2 å£°ç§°å¯¹æŸåæ–‡ä»¶ä½¿ç”¨"è·³è¿‡"ç­–ç•¥
  - ä½†æ²¡æœ‰æ˜ç¡®å¦‚ä½•è®°å½•é”™è¯¯
  - T1_PERF çš„è¶…æ—¶æµ‹è¯•æœŸæœ› ScanError::Timeoutï¼Œä½† wave2.2 å®šä¹‰çš„æ˜¯ ScanTimeoutError

  ä¸ä¸€è‡´ç¤ºä¾‹:
  // wave2.2:273 å®šä¹‰
  "error_handling": {
    "corrupted_jsonl": "è·³è¿‡æŸåæ–‡ä»¶ï¼Œè®°å½•åˆ°æ—¥å¿—"
  }

  // wave2.4:207 å®šä¹‰
  "assert!(matches!(result, Err(ScanError::Timeout)))"

  // ä½† ScanError å’Œ ScanTimeoutError çš„å…³ç³»ä¸æ˜ç¡®

  ---
  ğŸŸ¢ ä½ä¼˜å…ˆçº§é—®é¢˜ 6: Git åˆ†æ”¯ç­–ç•¥ä¸å®é™…æ‰§è¡Œä¸ä¸€è‡´

  ä½ç½®: wave2_phase1_core.json:34-39

  é—®é¢˜è¯¦æƒ…:
  "branch": {
    "name": "feat/phase1-wave2",
    "base": "master",
    "strategy": "feature_branch",
    "depends_on": ["feat/phase1-wave1"]
  }

  æ­§ä¹‰åˆ†æ:
  - ä¸»åˆ†æ”¯æ˜¯ feat/phase1-wave2
  - ä½† sequential_tasks ä¸­æ¯ä¸ªä»»åŠ¡åˆæœ‰è‡ªå·±çš„ sub_branch:
    - T1_3: feat/phase1-wave2-t1_3
    - T1_2: feat/phase1-wave2-t1_2
    - T1_PERF: feat/phase1-wave2-t1_perf
  - æ²¡æœ‰è¯´æ˜å¦‚ä½•ç®¡ç†è¿™äº›å­åˆ†æ”¯ä¸ä¸»åˆ†æ”¯çš„å…³ç³»

  å»ºè®®è¡¥å……:
  "branch_strategy": {
    "main_branch": "feat/phase1-wave2",
    "sub_branches": ["t1_3", "t1_2", "t1_perf"],
    "workflow": "æ¯ä¸ªä»»åŠ¡åœ¨å­åˆ†æ”¯å¼€å‘ â†’ åˆå¹¶åˆ°ä¸»åˆ†æ”¯ â†’ æœ€ç»ˆåˆå¹¶åˆ° master"
  }

  ---
  ä¸‰ã€ç¼ºå°‘çš„å¿…è¦ä¿¡æ¯

  1. æµ‹è¯•ç¯å¢ƒéš”ç¦»æœºåˆ¶

  é—®é¢˜: T1_PERF éœ€è¦åˆ›å»º 100 ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œä½†æ²¡æœ‰è¯´æ˜ï¼š
  - å¦‚ä½•ç¡®ä¿æµ‹è¯•ä¸ä¼šå¹²æ‰°å¼€å‘è€…çš„å®é™…ä¼šè¯æ•°æ®ï¼Ÿ
  - æµ‹è¯•æ–‡ä»¶åº”è¯¥æ”¾åœ¨å“ªé‡Œï¼Ÿ~/.claude/projects/test-*ï¼Ÿ
  - å¦‚ä½•åœ¨æµ‹è¯•å¤±è´¥åæ¸…ç†ç¯å¢ƒï¼Ÿ

  å»ºè®®: åœ¨ wave2.7 T2_006 ä¸­æ·»åŠ ï¼š
  const TEST_PREFIX: &str = "test-prism-forge-";

  fn ensure_test_directory_isolated() {
      // ç¡®ä¿æµ‹è¯•ç›®å½•ä¸çœŸå®æ•°æ®éš”ç¦»
  }

  ---
  2. Windows æ–‡ä»¶é”å®šæ£€æµ‹çš„æƒé™é—®é¢˜

  é—®é¢˜: wave2.2 Step 3 ä½¿ç”¨ Windows API æ£€æµ‹æ–‡ä»¶é”å®šï¼Œä½†æ²¡æœ‰è¯´æ˜ï¼š
  - éœ€è¦ä»€ä¹ˆæƒé™ï¼Ÿ
  - å¦‚æœæ£€æµ‹å¤±è´¥ï¼ˆæƒé™ä¸è¶³ï¼‰å¦‚ä½•å¤„ç†ï¼Ÿ
  - é Windows å¹³å°å¦‚ä½•æ¨¡æ‹Ÿæ­¤æµ‹è¯•ï¼Ÿ

  å»ºè®®: åœ¨ wave2.4 ä¸­æ·»åŠ è·¨å¹³å°æµ‹è¯•è¯´æ˜ï¼š
  #[cfg(test)]
  mod lock_detection_tests {
      #[cfg(target_os = "windows")]
      fn test_lock_detection_requires_admin() {
          // éªŒè¯æƒé™éœ€æ±‚
      }

      #[cfg(not(target_os = "windows"))]
      fn test_lock_detection_fallback() {
          // Unix å¹³å°æµ‹è¯•æ—¶é—´åˆ¤æ–­
      }
  }

  ---
  3. æ€§èƒ½åŸºå‡†çš„ç¡¬ä»¶ç¯å¢ƒè¯´æ˜

  é—®é¢˜: æ€§èƒ½ç›®æ ‡ "100 ä¸ªä¼šè¯ < 2 ç§’" ä¾èµ–äºï¼š
  - CPU æ€§èƒ½
  - ç£ç›˜ I/O é€Ÿåº¦
  - æ“ä½œç³»ç»Ÿ

  ä½†æ²¡æœ‰è¯´æ˜åŸºå‡†æµ‹è¯•çš„ç¡¬ä»¶è¦æ±‚ã€‚

  å»ºè®®: åœ¨ wave2.4 ä¸­æ·»åŠ ï¼š
  "test_environment": {
    "minimum_cpu": "4 cores",
    "recommended_disk": "SSD",
    "operating_systems": ["Windows 10+", "macOS 12+", "Ubuntu 20.04+"],
    "note": "æ€§èƒ½ç›®æ ‡åŸºäºä¸­ç­‰é…ç½®ç¡¬ä»¶ï¼Œå®é™…ç»“æœå¯èƒ½å› ç¡¬ä»¶è€Œå¼‚"
  }

  ---
  4. æ•°æ®åº“è¿ç§»å¤±è´¥åçš„æ¢å¤ç­–ç•¥

  é—®é¢˜: wave2.5 æä¾›äº†å›æ»šè®¡åˆ’ï¼Œä½†æ²¡æœ‰è¯´æ˜ï¼š
  - è¿ç§»è¿‡ç¨‹ä¸­æ–­ï¼ˆå¦‚æ–­ç”µï¼‰æ€ä¹ˆåŠï¼Ÿ
  - éƒ¨åˆ†è¿ç§»æˆåŠŸåçš„çŠ¶æ€å¦‚ä½•æ£€æµ‹ï¼Ÿ
  - å¦‚ä½•å®‰å…¨åœ°é‡è¯•å¤±è´¥çš„è¿ç§»ï¼Ÿ

  å»ºè®®: åœ¨ wave2.3 ä¸­æ·»åŠ äº‹åŠ¡æ€§è¿ç§»è¯´æ˜ï¼š
  pub fn migrate_with_rollback(conn: &mut Connection) -> Result<()> {
      let tx = conn.unchecked_transaction()?;
      // æ‰§è¡Œè¿ç§»
      // å¦‚æœå¤±è´¥ï¼Œtx.drop() è‡ªåŠ¨å›æ»š
      tx.commit()?;
  }

  ---
  å››ã€æ€»ç»“ä¸å»ºè®®

  | é—®é¢˜ç±»å‹           | æ•°é‡ | ä¸¥é‡æ€§ | çŠ¶æ€     |
  |--------------------|------|--------|----------|
  | å‰ç½®æ¡ä»¶é€»è¾‘çŸ›ç›¾   | 1    | ğŸ”´ é«˜  | éœ€ä¿®å¤   |
  | æµ‹è¯•æ•°æ®å‡†å¤‡ä¸å®Œæ•´ | 1    | ğŸŸ  ä¸­  | éœ€è¡¥å……   |
  | è·¨æ¨¡æ¿ä¾èµ–ä¸æ˜ç¡®   | 1    | ğŸŸ  ä¸­  | éœ€æ¾„æ¸…   |
  | ç¼“å­˜å®ç°é€»è¾‘ä¸å®Œæ•´ | 1    | ğŸŸ¡ ä½  | å¯å»¶å   |
  | é”™è¯¯å¤„ç†ç­–ç•¥ä¸ç»Ÿä¸€ | 1    | ğŸŸ¡ ä½  | å¯å»¶å   |
  | Git åˆ†æ”¯ç­–ç•¥ä¸æ¸…   | 1    | ğŸŸ¢ ä½  | æ–‡æ¡£è¡¥å…… |
  | ç¼ºå°‘æµ‹è¯•ç¯å¢ƒéš”ç¦»   | 1    | ğŸŸ¡ ä½  | å»ºè®®æ·»åŠ  |
  | ç¼ºå°‘ç¡¬ä»¶ç¯å¢ƒè¯´æ˜   | 1    | ğŸŸ¢ ä½  | æ–‡æ¡£è¡¥å…… |
  | ç¼ºå°‘è¿ç§»å¤±è´¥æ¢å¤   | 1    | ğŸŸ¡ ä½  | å»ºè®®æ·»åŠ  |

  ---
  äº”ã€ä¼˜å…ˆä¿®å¤å»ºè®®

  å¿…é¡»åœ¨æ‰§è¡Œ Wave 2 å‰ä¿®å¤:
  1. ä¿®æ­£ wave2.8 ä¸­å…³äº scan_cache_enabled çš„å‰ç½®æ¡ä»¶è¯´æ˜
  2. è¡¥å…… T1_PERF çš„æµ‹è¯•æ•°æ®å‡†å¤‡é€»è¾‘ï¼ˆmedium/large filesï¼‰

  å»ºè®®åœ¨ Wave 2 æ‰§è¡Œè¿‡ç¨‹ä¸­åŒæ­¥ä¿®å¤:
  3. æ˜ç¡®è·¨æ¨¡æ¿ä¾èµ–å…³ç³»
  4. è¡¥å……ç¼“å­˜å®ç°çš„å®Œæ•´é€»è¾‘

  å¯ä»¥å»¶ååˆ° Wave 3 æˆ–åç»­:
  5. ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥
  6. å®Œå–„ Git åˆ†æ”¯ç­–ç•¥æ–‡æ¡£

  ---
  è¿™ä¸ªåˆ†ææŠ¥å‘ŠåŸºäºæ‚¨æä¾›çš„æ‰€æœ‰ wave2 æ–‡ä»¶ã€‚å¦‚æœæ‚¨éœ€è¦æˆ‘é’ˆå¯¹æŸä¸ªå…·ä½“é—®é¢˜æä¾›æ›´è¯¦ç»†çš„ä¿®å¤å»ºè®®ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼

> åŸºäºåˆšæ‰å¯¹ Wave 2 çš„æ·±åº¦åˆ†æï¼ˆDry-Runï¼‰ï¼Œè¯·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š



1\. \*\*å¤ç›˜ä¸æ–¹æ³•è®ºæå–\*\*ï¼š

å›é¡¾ä½ åˆšæ‰çš„æ€è€ƒè¿‡ç¨‹ï¼Œä½ æ˜¯å¦‚ä½•å‘ç° `wave2.8` å’Œ `wave2.3` ä¹‹é—´å…³äº 
`scan\_cache\_enabled` å­—æ®µçš„é€»è¾‘çŸ›ç›¾çš„ï¼Ÿä½ æ˜¯å¦‚ä½•å¯Ÿè§‰ T1\_PERF 
ç¼ºå°‘å¤§æ–‡ä»¶ç”Ÿæˆé€»è¾‘çš„ï¼Ÿè¯·å°†è¿™äº›ç›´è§‰è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„\*\*â€œæ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºâ€ (Deep 
Review Methodology)\*\*ã€‚



2\. \*\*æŠ€èƒ½ä¼˜åŒ–ææ¡ˆ (optimize-wave)\*\*ï¼š

å‡è®¾æˆ‘ä»¬è¦å°†è¿™ç§èƒ½åŠ›å›ºåŒ–ä¸º `optimize-wave` 
æŠ€èƒ½ï¼Œè¯·è®¾è®¡è¯¥æŠ€èƒ½çš„æ‰§è¡Œé€»è¾‘ã€‚éœ€åŒ…å«ï¼š

\- \*\*è¾“å…¥\*\*ï¼šWave æ ¸å¿ƒæ–‡ä»¶åŠæ‰€æœ‰å­æ–‡ä»¶ã€‚

\- \*\*æ ¸å¿ƒå®¡æŸ¥ç»´åº¦\*\*ï¼š

\- \*\*ä¸€è‡´æ€§æ£€æŸ¥ (Consistency 
Check)\*\*ï¼šè·¨æ–‡ä»¶ç‰ˆæœ¬å·ã€å­—æ®µæ¥æºã€ä¾èµ–å…³ç³»æ˜¯å¦é—­ç¯ï¼Ÿ

\- \*\*å®Œæ•´æ€§æ£€æŸ¥ (Completeness 
Check)\*\*ï¼šæµ‹è¯•æ•°æ®æ˜¯å¦å…·å¤‡ç”Ÿæˆä»£ç ï¼Ÿé”™è¯¯å¤„ç†æ˜¯å¦è¦†ç›–ï¼Ÿ

\- \*\*å¯æ‰§è¡Œæ€§æ¨¡æ‹Ÿ (Dry-Run 
Simulation)\*\*ï¼šæ¨¡æ‹Ÿä»£ç æ‰§è¡Œè·¯å¾„ï¼Œå¯»æ‰¾â€œå®šä¹‰äº†ä½†æœªå®ç°â€çš„é€»è¾‘ã€‚

\- \*\*è¾“å‡ºæ ‡å‡†\*\*ï¼šå®šä¹‰ä¸€ä»½æ ‡å‡†åŒ–çš„ã€ŠWave é¢„æ‰§è¡Œå¥åº·æŠ¥å‘Šã€‹æ¨¡æ¿ã€‚



è¯·ä»¥ç³»ç»Ÿæ¶æ„å¸ˆçš„è§’åº¦ï¼Œè¾“å‡ºè¿™ä»½æŠ€èƒ½è®¾è®¡æ–‡æ¡£ã€‚ 

â— ğŸ“‹ æ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºä¸ optimize-wave æŠ€èƒ½è®¾è®¡æ–‡æ¡£

  ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤ç›˜ä¸æ–¹æ³•è®ºæå–

  ä¸€ã€æˆ‘çš„åˆ†ææ€è€ƒè¿‡ç¨‹å¤ç›˜

  ğŸ” æ¡ˆä¾‹ç ”ç©¶ 1ï¼šå‘ç° scan_cache_enabled é€»è¾‘çŸ›ç›¾

  æˆ‘çš„æ€è€ƒè·¯å¾„ï¼š

  Step 1: åœ¨ wave2.8 (å‰ç½®æ¡ä»¶) ä¸­çœ‹åˆ°
    â””â”€ "wave1_version": "migrate_v6 åˆ›å»º"
    â””â”€ éªŒè¯ SQL: SELECT scan_cache_enabled FROM settings

  Step 2: åœ¨ wave2.3 (T1_3 ä»»åŠ¡) ä¸­çœ‹åˆ°
    â””â”€ "step": 6, "migration_version": 12
    â””â”€ ALTER TABLE settings ADD COLUMN scan_cache_enabled

  Step 3: è§¦å‘"æ—¶é—´çº¿ä¸ä¸€è‡´"ç›´è§‰
    â””â”€ â“ wave2.8 è¯´åœ¨ Wave 1 åˆ›å»º
    â””â”€ â“ wave2.3 è¯´åœ¨ Wave 2 åˆ›å»º (migrate_v12)
    â””â”€ âš ï¸ çŸ›ç›¾ï¼åŒä¸€ä¸ªå­—æ®µä¸å¯èƒ½åœ¨ä¸¤ä¸ª Wave ä¸­åˆ›å»º

  Step 4: æ·±æŒ–éªŒè¯
    â””â”€ æŸ¥çœ‹ wave2.8 çš„ verification_checkpoints
    â””â”€ å‘ç° V_WAVE2_008 æœŸæœ› Wave 1 å®Œæˆå°±æœ‰æ­¤å­—æ®µ
    â””â”€ ä½†å®é™… Wave 2 æ‰§è¡Œå‰ä¼šå¤±è´¥

  Step 5: ç»“è®º
    â””â”€ è¿™æ˜¯"å£°æ˜-å®ç°"æ—¶é—´è½´çš„é”™ä½
    â””â”€ å½±å“èŒƒå›´ï¼šå‰ç½®æ¡ä»¶éªŒè¯é€»è¾‘å¤±æ•ˆ

  æ ¸å¿ƒç›´è§‰æŠ½è±¡ï¼š
  æ—¶é—´è½´äº¤å‰éªŒè¯æ³•åˆ™ - å½“åŒä¸€å®ä½“åœ¨ä¸åŒæ–‡ä»¶ä¸­è¢«èµ‹äºˆä¸åŒçš„"èµ·æºæ—¶é—´"æ—¶ï¼Œå¿…ç„¶å­˜åœ¨é€»è¾‘çŸ›ç›¾ã€‚

  ---
  ğŸ” æ¡ˆä¾‹ç ”ç©¶ 2ï¼šå‘ç° T1_PERF æµ‹è¯•æ•°æ®ç¼ºå¤±

  æˆ‘çš„æ€è€ƒè·¯å¾„ï¼š

  Step 1: åœ¨ wave2.4 ä¸­çœ‹åˆ°æ•°æ®åˆ†å¸ƒå£°æ˜
    â””â”€ "data_distribution": {
         "small_files": 70%,
         "medium_files": 25% (1-5MB),
         "large_files": 5% (>5MB)
       }

  Step 2: åœ¨ wave2.4 ä¸­çœ‹åˆ°æµ‹è¯•åœºæ™¯
    â””â”€ "1000 ä¸ªä¼šè¯ï¼ˆå‹åŠ›æµ‹è¯•ï¼‰"

  Step 3: è·Ÿè¸ªåˆ° wave2.7 T2_006 æ¨¡æ¿å®ç°
    â””â”€ setup_test_environment() {
         for i in 0..10:
           for j in 0..10:
             åˆ›å»ºæ–‡ä»¶ï¼Œå†™å…¥ 10 è¡Œæ¶ˆæ¯
       }
    â””â”€ 10 Ã— 10 = 100 ä¸ªæ–‡ä»¶
    â””â”€ æ¯ä¸ªæ–‡ä»¶çº¦ 1KB

  Step 4: è§¦å‘"éœ€æ±‚-å®ç°"ç¼ºå£ç›´è§‰
    â””â”€ â“ 1KB æ–‡ä»¶ â‰  "1-5MB" (medium_files)
    â””â”€ â“ 100 ä¸ªæ–‡ä»¶ â‰  "1000 ä¸ªä¼šè¯"
    â””â”€ âš ï¸ å£°æ˜äº†ä½†æœªå®ç°

  Step 5: ä»£ç é™æ€åˆ†æ
    â””â”€ T2_006 ä¸­æ²¡æœ‰ç”Ÿæˆå¤§æ–‡ä»¶çš„ä»£ç 
    â””â”€ T2_006 ä¸­æ²¡æœ‰ç”Ÿæˆ 1000 ä¸ªæ–‡ä»¶çš„ä»£ç 
    â””â”€ ç¼ºå°‘ setup_large_test_file() å‡½æ•°
    â””â”€ ç¼ºå°‘ setup_stress_test_environment() å‡½æ•°

  Step 6: ç»“è®º
    â””â”€ è¿™æ˜¯"å£°æ˜-å®ç°"è¦†ç›–é¢çš„ç¼ºå£
    â””â”€ å½±å“èŒƒå›´ï¼šæ€§èƒ½æµ‹è¯•ä¸å®Œæ•´

  æ ¸å¿ƒç›´è§‰æŠ½è±¡ï¼š
  å£°æ˜-å®ç°è¦†ç›–é¢å¯¹æ¯”æ³•åˆ™ - å½“éœ€æ±‚å£°æ˜åŒ…å«å¤šä¸ªåœºæ™¯ï¼Œä½†å®ç°ä»£ç åªè¦†ç›–éƒ¨åˆ†åœºæ™¯æ—¶ï¼Œå¿…ç„¶å­˜åœ¨é—æ¼ã€‚

  ---
  äºŒã€æ·±åº¦å®¡æŸ¥æ–¹æ³•è®º

  åŸºäºä»¥ä¸Šå¤ç›˜ï¼Œæˆ‘æç‚¼å‡ºä»¥ä¸‹ä¸‰ç»´äº¤å‰éªŒè¯æ¡†æ¶ï¼š

  ğŸ¯ ç»´åº¦ä¸€ï¼šæ—¶é—´è½´äº¤å‰éªŒè¯

  æ£€æŸ¥ç›®æ ‡ï¼šè·¨æ–‡ä»¶çš„"èµ·æºæ—¶é—´"å£°æ˜æ˜¯å¦ä¸€è‡´

  æ‰§è¡Œæ­¥éª¤ï¼š
  1. è¯†åˆ«å…³é”®å®ä½“çš„"åˆ›å»ºæ—¶é—´"å£°æ˜
     - æ•°æ®åº“å­—æ®µï¼šåœ¨å“ªä¸ª migrate ç‰ˆæœ¬åˆ›å»ºï¼Ÿ
     - å‡½æ•°/æ–¹æ³•ï¼šåœ¨å“ªä¸ªä»»åŠ¡/æ­¥éª¤ä¸­å®šä¹‰ï¼Ÿ
     - é…ç½®é¡¹ï¼šåœ¨å“ªä¸ªé˜¶æ®µå¼•å…¥ï¼Ÿ

  2. æ„å»ºå®ä½“æ—¶é—´çº¿æ˜ å°„è¡¨
     entity = {
       name: "scan_cache_enabled",
       origins: [
         { file: "wave2.8", time: "Wave 1", source: "migrate_v6" },
         { file: "wave2.3", time: "Wave 2", source: "migrate_v12" }
       ]
     }

  3. æ£€æµ‹æ—¶é—´è½´å†²çª
     - åŒä¸€å®ä½“æœ‰å¤šä¸ªä¸åŒçš„"èµ·æºæ—¶é—´" â†’ å†²çª
     - å‰ç½®æ¡ä»¶æœŸæœ›çš„æ—¶é—´ vs å®é™…åˆ›å»ºæ—¶é—´ â†’ å†²çª
     - ä¾èµ–å…³ç³»ä¸­çš„æ—¶é—´å…ˆåé¡ºåº â†’ æ˜¯å¦åˆç†ï¼Ÿ

  4. ç”Ÿæˆå†²çªæŠ¥å‘Š
     {
       entity: "scan_cache_enabled",
       conflict_type: "æ—¶é—´è½´ä¸ä¸€è‡´",
       file_a: "wave2.8 (Wave 1)",
       file_b: "wave2.3 (Wave 2)",
       severity: "HIGH",
       impact: "å‰ç½®æ¡ä»¶éªŒè¯å¤±è´¥"
     }

  æ¨¡å¼åº“ï¼š
  - æ¨¡å¼ Aï¼šå‰ç½®æ¡ä»¶å£°ç§° X å·²å­˜åœ¨ï¼Œä½†å®é™…åœ¨å½“å‰ Wave åˆ›å»º
  - æ¨¡å¼ Bï¼šä»»åŠ¡ A å£°æ˜ä¾èµ– Xï¼Œä½† X åœ¨ä»»åŠ¡ A ä¹‹åæ‰åˆ›å»º
  - æ¨¡å¼ Cï¼šè¿ç§»ç‰ˆæœ¬å·è·³è·ƒï¼ˆv8 â†’ v12ï¼Œä¸­é—´ v9-v11 æœªå£°æ˜ï¼‰

  ---
  ğŸ¯ ç»´åº¦äºŒï¼šè¦†ç›–é¢å¯¹æ¯”éªŒè¯

  æ£€æŸ¥ç›®æ ‡ï¼šéœ€æ±‚å£°æ˜çš„åœºæ™¯ vs ä»£ç å®ç°çš„åœºæ™¯

  æ‰§è¡Œæ­¥éª¤ï¼š
  1. æå–éœ€æ±‚åœºæ™¯åˆ—è¡¨
     requirements = [
       "æµ‹è¯• 100 ä¸ªä¼šè¯",
       "æµ‹è¯• medium_files (1-5MB)",
       "æµ‹è¯• large_files (>5MB)",
       "æµ‹è¯• 1000 ä¸ªä¼šè¯ï¼ˆå‹åŠ›æµ‹è¯•ï¼‰"
     ]

  2. é™æ€åˆ†æä»£ç å®ç°
     implementation = analyze_code("T2_006 template")
     implementationscenarios = [
       "åˆ›å»º 100 ä¸ªæ–‡ä»¶",
       "æ¯ä¸ªæ–‡ä»¶ 1KB",
       "æ€»å…± 100 ä¸ªä¼šè¯"
     ]

  3. è®¡ç®—è¦†ç›–ç‡çŸ©é˜µ
     coverage = {
       "100 ä¸ªä¼šè¯": âœ… å·²å®ç°,
       "medium_files": âŒ æœªå®ç°,
       "large_files": âŒ æœªå®ç°,
       "1000 ä¸ªä¼šè¯": âŒ æœªå®ç°
     }
     coverage_rate = 1 / 4 = 25%

  4. è¯†åˆ«ç¼ºå¤±å®ç°
     missing_implementations = [
       {
         requirement: "medium_files (1-5MB)",
         expected_code: "setup_medium_test_file()",
         actual_code: null,
         severity: "MEDIUM"
       },
       {
         requirement: "large_files (>5MB)",
         expected_code: "setup_large_test_file()",
         actual_code: null,
         severity: "MEDIUM"
       },
       {
         requirement: "1000 ä¸ªä¼šè¯",
         expected_code: "setup_stress_test_environment()",
         actual_code: null,
         severity: "HIGH"
       }
     ]

  æ¨¡å¼åº“ï¼š
  - æ¨¡å¼ Aï¼šå£°æ˜äº†æšä¸¾ç±»å‹ï¼ˆsmall/medium/largeï¼‰ï¼Œä½†åªå®ç°äº†ä¸€ä¸ª
  - æ¨¡å¼ Bï¼šå£°æ˜äº†è¾¹ç•Œå€¼æµ‹è¯•ï¼ˆ0, æ­£å¸¸, æœ€å¤§å€¼ï¼‰ï¼Œä½†åªæµ‹è¯•äº†æ­£å¸¸å€¼
  - æ¨¡å¼ Cï¼šå£°æ˜äº†å¼‚å¸¸å¤„ç†ï¼Œä½† try-catch å—ä¸ºç©ºæˆ–åªæœ‰ TODO æ³¨é‡Š

  ---
  ğŸ¯ ç»´åº¦ä¸‰ï¼šç¬¦å·å¼•ç”¨é“¾è¿½è¸ª

  æ£€æŸ¥ç›®æ ‡ï¼šæ‰€æœ‰è¢«å¼•ç”¨çš„ç¬¦å·æ˜¯å¦éƒ½æœ‰å®šä¹‰

  æ‰§è¡Œæ­¥éª¤ï¼š
  1. æ„å»ºç¬¦å·å¼•ç”¨å›¾ (SRG - Symbol Reference Graph)
     symbols = {
       "get_active_threshold()": {
         references: [
           { file: "wave2.2", line: 86, context: "is_session_active è°ƒç”¨" },
           { file: "wave2.2", line: 102, context: "å‡½æ•°ç­¾åå£°æ˜" }
         ],
         definition: null  // âŒ æœªæ‰¾åˆ°å®ç°
       },
       "scan_sessions_with_timeout()": {
         references: [
           { file: "wave2.4", line: 114, context: "æ€§èƒ½æµ‹è¯•è°ƒç”¨" }
         ],
         definition: { file: "wave2.2", line: 188 }  // âœ… å·²å®šä¹‰
       }
     }

  2. æ£€æµ‹ç¬¦å·å­¤å²›
     orphan_symbols = []
     for symbol in symbols:
       if symbol.definition == null:
         orphan_symbols.append(symbol)

  3. åˆ†æå­¤å²›å½±å“
     for orphan in orphan_symbols:
       impact = analyze_impact(orphan)
       # ç¼–è¯‘å¤±è´¥ï¼Ÿè¿è¡Œæ—¶é”™è¯¯ï¼ŸåŠŸèƒ½ç¼ºå¤±ï¼Ÿ

  4. ç”Ÿæˆä¿®å¤å»ºè®®
     for orphan in orphan_symbols:
       recommend_template(orphan)

  æ¨¡å¼åº“ï¼š
  - æ¨¡å¼ Aï¼šå‡½æ•°è¢«è°ƒç”¨ä½†åªæœ‰ç­¾åå£°æ˜ï¼Œæ— å®ç°ä½“
  - æ¨¡å¼ Bï¼šç»“æ„ä½“è¢«ä½¿ç”¨ä½†æœªå®šä¹‰
  - æ¨¡å¼ Cï¼šæ¨¡æ¿å¼•ç”¨äº†å¦ä¸€ä¸ªæ¨¡æ¿ï¼Œä½†æœªå£°æ˜ä¾èµ–å…³ç³»

  ---
  ğŸ¯ ç»´åº¦å››ï¼šæ•°æ®æµè¿ç»­æ€§éªŒè¯

  æ£€æŸ¥ç›®æ ‡ï¼šæ•°æ®ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„ä¼ é€’é“¾æ˜¯å¦å®Œæ•´

  æ‰§è¡Œæ­¥éª¤ï¼š
  1. è¯†åˆ«æ•°æ®èµ„æº
     resources = [
       "Session.rating",
       "settings.active_threshold",
       "scan_sessions_with_timeout"
     ]

  2. è¿½è¸ªæ¯ä¸ªèµ„æºçš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…é“¾
     for resource in resources:
       producer = find_producer(resource)  # è°åˆ›å»ºï¼Ÿ
       consumer = find_consumer(resource)  # è°ä½¿ç”¨ï¼Ÿ
       transmission = find_transmission(resource)  # å¦‚ä½•ä¼ é€’ï¼Ÿ

       flow = {
         resource: "Session.rating",
         producer: { task: "T1_3", file: "migrations.rs", action: "migrate_v9" },
         transmission: { file: "models.rs", type: "struct field" },
         consumer: { task: "T1_2", file: "scanner.rs", action: "è¯»å–" }
       }

  3. æ£€æµ‹æ–­é“¾
     break_points = []
     for flow in flows:
       if not flow.producer or not flow.consumer or not flow.transmission:
         break_points.append(flow)

  4. éªŒè¯ç±»å‹å…¼å®¹æ€§
     type_errors = []
     for flow in flows:
       producer_type = get_type(producer)
       consumer_type = get_type(consumer)
       if not is_compatible(producer_type, consumer_type):
         type_errors.append(flow)

  æ¨¡å¼åº“ï¼š
  - æ¨¡å¼ Aï¼šç”Ÿäº§è€…è¿”å› Result<Vec<T>>ï¼Œæ¶ˆè´¹è€…æœŸæœ› Vec<T>ï¼ˆæœªå¤„ç†é”™è¯¯ï¼‰
  - æ¨¡å¼ Bï¼šæ•°æ®é€šè¿‡å…¨å±€çŠ¶æ€ä¼ é€’ï¼Œä½†æœªæ˜ç¡®åˆå§‹åŒ–æ—¶æœº
  - æ¨¡å¼ Cï¼šæ¶ˆè´¹è€…åœ¨æ•°æ®å¯ç”¨ä¹‹å‰å°±è¢«è°ƒç”¨ï¼ˆä¾èµ–é¡ºåºé”™è¯¯ï¼‰

  ---
  ä¸‰ã€ç»¼åˆå®¡æŸ¥æµç¨‹

  å°†ä»¥ä¸Šå››ä¸ªç»´åº¦ç»„åˆæˆæ ‡å‡†æµç¨‹ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Phase 1: æ–‡ä»¶ç»“æ„è§£æ                               â”‚
  â”‚  - è¯†åˆ«æ‰€æœ‰ Wave æ–‡ä»¶ï¼ˆä¸»æ–‡ä»¶ + å­ä»»åŠ¡æ–‡ä»¶ï¼‰         â”‚
  â”‚  - æ„å»ºæ–‡ä»¶ä¾èµ–å›¾                                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Phase 2: å®ä½“æå–                                   â”‚
  â”‚  - è¯†åˆ«æ‰€æœ‰å®ä½“ï¼ˆå­—æ®µã€å‡½æ•°ã€é…ç½®ã€æµ‹è¯•åœºæ™¯ï¼‰        â”‚
  â”‚  - æå–å®ä½“å±æ€§ï¼ˆåˆ›å»ºæ—¶é—´ã€å®šä¹‰ä½ç½®ã€å¼•ç”¨ä½ç½®ï¼‰      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Phase 3: å››ç»´éªŒè¯                                   â”‚
  â”‚  - æ—¶é—´è½´äº¤å‰éªŒè¯                                    â”‚
  â”‚  - è¦†ç›–é¢å¯¹æ¯”éªŒè¯                                    â”‚
  â”‚  - ç¬¦å·å¼•ç”¨é“¾è¿½è¸ª                                    â”‚
  â”‚  - æ•°æ®æµè¿ç»­æ€§éªŒè¯                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Phase 4: å†²çªåˆ†ç±»ä¸è¯„çº§                             â”‚
  â”‚  - CRITICAL: é˜»å¡æ‰§è¡Œ                               â”‚
  â”‚  - HIGH: åŠŸèƒ½ç¼ºå¤±                                    â”‚
  â”‚  - MEDIUM: é€»è¾‘ä¸ä¸€è‡´                                â”‚
  â”‚  - LOW: æ–‡æ¡£/æ³¨é‡Šé—®é¢˜                                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Phase 5: æŠ¥å‘Šç”Ÿæˆ                                   â”‚
  â”‚  - ç”Ÿæˆã€ŠWave é¢„æ‰§è¡Œå¥åº·æŠ¥å‘Šã€‹                      â”‚
  â”‚  - æä¾›ä¿®å¤å»ºè®®                                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ---
  ç¬¬äºŒéƒ¨åˆ†ï¼šoptimize-wave æŠ€èƒ½è®¾è®¡æ–‡æ¡£

  ä¸€ã€æŠ€èƒ½æ¦‚è¿°

  skill:
    name: optimize-wave
    version: 1.0.0
    category: code-review
    description: "Wave è®¡åˆ’æ·±åº¦é¢„æ‰§è¡Œå®¡æŸ¥å¼•æ“"

    purpose: |
      åœ¨æ‰§è¡Œ Wave ä»»åŠ¡å‰ï¼Œè¿›è¡Œæ·±åº¦é™æ€åˆ†æï¼Œå‘ç°ï¼š
      - é€»è¾‘çŸ›ç›¾ï¼ˆå¦‚æ—¶é—´è½´å†²çªï¼‰
      - å®ç°ç¼ºå£ï¼ˆå¦‚æµ‹è¯•æ•°æ®ç¼ºå¤±ï¼‰
      - ç¬¦å·å­¤å²›ï¼ˆå¦‚æœªå®šä¹‰çš„å‡½æ•°ï¼‰
      - æ•°æ®æµæ–­é“¾ï¼ˆå¦‚ä¾èµ–é¡ºåºé”™è¯¯ï¼‰

    input:
      - Wave æ ¸å¿ƒæ–‡ä»¶ (wave*_phase*.json)
      - æ‰€æœ‰å­ä»»åŠ¡æ–‡ä»¶ (wave*.task_*.json)
      - æ”¯æŒæ–‡ä»¶ (templates, prerequisites, integration, strategy)

    output:
      - ã€ŠWave é¢„æ‰§è¡Œå¥åº·æŠ¥å‘Šã€‹
      - é—®é¢˜æ¸…å•ï¼ˆæŒ‰ä¸¥é‡æ€§åˆ†çº§ï¼‰
      - ä¿®å¤å»ºè®®ï¼ˆåŒ…å«ä»£ç ç¤ºä¾‹ï¼‰

  ---
  äºŒã€æ ¸å¿ƒå®¡æŸ¥ç»´åº¦

  âœ… ç»´åº¦ 1ï¼šä¸€è‡´æ€§æ£€æŸ¥

  æ£€æŸ¥é¡¹ï¼š
  consistency_checks:
    - name: "æ—¶é—´è½´ä¸€è‡´æ€§"
      description: "è·¨æ–‡ä»¶çš„å®ä½“èµ·æºæ—¶é—´æ˜¯å¦ä¸€è‡´"

      check_logic: |
        for each entity in wave:
          origins = collect_origins(entity)
          if len(origins) > 1:
            for origin_a, origin_b in combinations(origins, 2):
              if origin_a.wave != origin_b.wave:
                report_conflict(entity, origin_a, origin_b)

      example_conflict:
        entity: "scan_cache_enabled"
        file_a: "wave2.8 (å£°ç§° Wave 1 åˆ›å»º)"
        file_b: "wave2.3 (å®é™… Wave 2 åˆ›å»º)"
        severity: "CRITICAL"

    - name: "ç‰ˆæœ¬å·ä¸€è‡´æ€§"
      description: "æ•°æ®åº“è¿ç§»ç‰ˆæœ¬å·æ˜¯å¦è¿ç»­"

      check_logic: |
        versions = extract_migration_versions(wave)
        for i in range(1, len(versions)):
          if versions[i] != versions[i-1] + 1:
            report_version_gap(versions[i-1], versions[i])

      example_gap:
        current_version: 8
        next_version: 12  # è·³è¿‡äº† v9, v10, v11
        severity: "MEDIUM"

    - name: "ä¾èµ–å…³ç³»é—­ç¯"
      description: "æ‰€æœ‰å£°æ˜çš„ä¾èµ–æ˜¯å¦å·²æ»¡è¶³"

      check_logic: |
        for task in wave.tasks:
          for dep in task.dependencies:
            if dep not in completed_tasks:
              if dep not in current_wave.tasks:
                report_missing_dependency(task, dep)

      example_missing:
        task: "T1_2"
        depends_on: "T1_3"
        but: "T1_3 åœ¨å…¶ä»– Wave æˆ–æœªå®šä¹‰"
        severity: "CRITICAL"

  ---
  âœ… ç»´åº¦ 2ï¼šå®Œæ•´æ€§æ£€æŸ¥

  æ£€æŸ¥é¡¹ï¼š
  completeness_checks:
    - name: "æµ‹è¯•åœºæ™¯è¦†ç›–"
      description: "å£°æ˜çš„æµ‹è¯•åœºæ™¯æ˜¯å¦æœ‰å¯¹åº”å®ç°"

      check_logic: |
        requirements = extract_test_scenarios(wave)
        implementations = extract_test_implementations(wave.templates)

        for req in requirements:
          if not match_implementation(req, implementations):
            report_missing_test(req)

      example_missing:
        requirement: "æµ‹è¯• large_files (>5MB)"
        implementation: "null"
        expected_function: "setup_large_test_file()"
        severity: "HIGH"

    - name: "é”™è¯¯å¤„ç†è¦†ç›–"
      description: "å£°æ˜çš„é”™è¯¯å¤„ç†æ˜¯å¦æœ‰å®ç°"

      check_logic: |
        error_declarations = extract_error_handling(wave)
        code_blocks = extract_try_catch_blocks(wave.templates)

        for decl in error_declarations:
          if not find_implementation(decl, code_blocks):
            report_empty_error_handling(decl)

      example_empty:
        declared: "corrupted_jsonl: è·³è¿‡æŸåæ–‡ä»¶ï¼Œè®°å½•åˆ°æ—¥å¿—"
        actual: "// TODO: å¤„ç†æŸåæ–‡ä»¶"
        severity: "MEDIUM"

    - name: "æ–‡æ¡£å­—æ®µå®ç°"
      description: "æ–‡æ¡£ä¸­æè¿°çš„å­—æ®µæ˜¯å¦åœ¨ä»£ç ä¸­å®šä¹‰"

      check_logic: |
        doc_fields = extract_fields_from_documentation(wave)
        code_fields = extract_fields_from_structs(wave.templates)

        for field in doc_fields:
          if field not in code_fields:
            report_undefined_field(field)

      example_missing:
        documented: "Session.message_count"
        implemented: "null"
        severity: "HIGH"

  ---
  âœ… ç»´åº¦ 3ï¼šå¯æ‰§è¡Œæ€§æ¨¡æ‹Ÿ

  æ£€æŸ¥é¡¹ï¼š
  executable_simulation:
    - name: "ç¬¦å·å¼•ç”¨è§£æ"
      description: "æ‰€æœ‰è¢«å¼•ç”¨çš„ç¬¦å·æ˜¯å¦éƒ½æœ‰å®šä¹‰"

      check_logic: |
        # æ„å»ºç¬¦å·å¼•ç”¨å›¾ (SRG)
        srg = build_symbol_reference_graph(wave)

        # æ£€æµ‹å­¤å²›ç¬¦å·
        for symbol in srg:
          if symbol.definition == null:
            if symbol.references.length > 0:
              report_orphan_symbol(symbol)

      example_orphan:
        symbol: "get_active_threshold()"
        references: ["wave2.2:86", "wave2.2:102"]
        definition: "null"
        severity: "CRITICAL"

    - name: "è°ƒç”¨é“¾å¯è¾¾æ€§"
      description: "æ¨¡æ‹Ÿå‡½æ•°è°ƒç”¨é“¾ï¼Œæ£€æµ‹æ–­é“¾"

      check_logic: |
        for entry_point in wave.entry_points:
          call_chain = trace_execution(entry_point)
          
          for call in call_chain:
            if not is_resolvable(call):
              report_unresolvable_call(call, entry_point)

      example_broken:
        entry_point: "scan_sessions (Command)"
        call_chain: [
          "scan_sessions âœ…",
          "scanner::scan_session_files âœ…",
          "get_active_threshold âŒ (æœªå®šä¹‰)"
        ]
        severity: "CRITICAL"

    - name: "æ•°æ®æµéªŒè¯"
      description: "æ¨¡æ‹Ÿæ•°æ®ä¼ é€’ï¼Œæ£€æµ‹ç±»å‹ä¸å…¼å®¹"

      check_logic: |
        for flow in wave.data_flows:
          producer_type = infer_type(producer)
          consumer_type = infer_type(consumer)
          
          if not is_compatible(producer_type, consumer_type):
            report_type_mismatch(flow, producer_type, consumer_type)

      example_mismatch:
        resource: "Session.tags"
        producer_type: "Vec<String>"  // get_tags() è¿”å›
        consumer_type: "String"  // æ•°æ®åº“å­˜å‚¨ç±»å‹
        converter: "get_tags() å†…éƒ¨å·²å¤„ç†"
        severity: "LOW"  // å·²æœ‰è½¬æ¢é€»è¾‘

  ---
  âœ… ç»´åº¦ 4ï¼šé…ç½®é—­ç¯éªŒè¯

  æ£€æŸ¥é¡¹ï¼š
  configuration_closure:
    - name: "é…ç½®é¡¹å®Œæ•´æ€§"
      description: "é…ç½®é¡¹æ˜¯å¦æ»¡è¶³ å®šä¹‰â†’å­˜å‚¨â†’è¯»å–â†’å†™å…¥â†’UI é—­ç¯"

      check_logic: |
        for config in wave.configurations:
          closure = {
            definition: find_definition(config),
            storage: find_storage(config),
            read_function: find_read_function(config),
            write_function: find_write_function(config),
            ui: find_ui_element(config)
          }
          
          missing_links = [k for k, v in closure.items() if v == null]
          
          if missing_links:
            report_incomplete_closure(config, missing_links)

      example_incomplete:
        config: "active_threshold"
        definition: "âœ… wave2.2:91-112"
        storage: "âœ… Wave 1 migrate_v6"
        read_function: "âŒ æœªå®šä¹‰"
        write_function: "âŒ æœªå®šä¹‰"
        ui: "âš ï¸ æœªæ¥å®ç°"
        severity: "HIGH"

    - name: "é»˜è®¤å€¼ä¸€è‡´æ€§"
      description: "åŒä¸€é…ç½®é¡¹åœ¨ä¸åŒæ–‡ä»¶ä¸­çš„é»˜è®¤å€¼æ˜¯å¦ä¸€è‡´"

      check_logic: |
        for config in wave.configurations:
          default_values = collect_default_values(config)
          
          if len(set(default_values)) > 1:
            report_inconsistent_defaults(config, default_values)

      example_inconsistent:
        config: "scan_cache_enabled"
        values: ["true (wave2.2)", "1 (wave2.3)", "false (documentation)"]
        severity: "MEDIUM"

  ---
  ä¸‰ã€è¾“å‡ºæ ‡å‡†

  ã€ŠWave é¢„æ‰§è¡Œå¥åº·æŠ¥å‘Šã€‹æ¨¡æ¿

  # ğŸ“Š Wave {WAVE_ID} é¢„æ‰§è¡Œå¥åº·æŠ¥å‘Š

  **ç”Ÿæˆæ—¶é—´**: {timestamp}
  **å¼•æ“ç‰ˆæœ¬**: optimize-wave v1.0.0
  **åˆ†ææ–‡ä»¶æ•°**: {file_count}

  ---

  ## ğŸ¯ æ‰§è¡Œæ¦‚è§ˆ

  | æŒ‡æ ‡ | ç»“æœ |
  |------|------|
  | **æ€»ä½“è¯„åˆ†** | {score}/10 |
  | **æ˜¯å¦å¯æ‰§è¡Œ** | {executable} |
  | ğŸ”´ **CRITICAL** | {critical_count} ä¸ª |
  | ğŸŸ  **HIGH** | {high_count} ä¸ª |
  | ğŸŸ¡ **MEDIUM** | {medium_count} ä¸ª |
  | ğŸŸ¢ **LOW** | {low_count} ä¸ª |

  ---

  ## ğŸ”´ CRITICAL é—®é¢˜ï¼ˆé˜»å¡æ‰§è¡Œï¼‰

  ### é—®é¢˜ {index}: {title}

  **ä½ç½®**: `{file}:{line}`

  **ä¸¥é‡æ€§**: ğŸ”´ CRITICAL - **é˜»å¡æ‰§è¡Œ**

  **é—®é¢˜æè¿°**:
  {description}

  **å½±å“èŒƒå›´**:
  - {impact_1}
  - {impact_2}

  **ä¿®å¤å»ºè®®**:
  ```rust
  {fix_code}

  ç›¸å…³æ–‡ä»¶:
  - {related_file_1}
  - {related_file_2}

  ---
  ğŸŸ  HIGH é—®é¢˜ï¼ˆåŠŸèƒ½ç¼ºå¤±ï¼‰

  é—®é¢˜ {index}: {title}

  ä½ç½®: {file}:{line}

  ä¸¥é‡æ€§: ğŸŸ  HIGH

  é—®é¢˜æè¿°:
  {description}

  ç¼ºå¤±å®ç°:
  - {missing_1}
  - {missing_2}

  ä¿®å¤å»ºè®®:
  {fix_code}

  ---
  ğŸŸ¡ MEDIUM é—®é¢˜ï¼ˆé€»è¾‘ä¸ä¸€è‡´ï¼‰

  é—®é¢˜ {index}: {title}

  ä½ç½®: {file}:{line}

  ä¸¥é‡æ€§: ğŸŸ¡ MEDIUM

  é—®é¢˜æè¿°:
  {description}

  å»ºè®®ä¿®å¤:
  {recommendation}

  ---
  ğŸŸ¢ LOW é—®é¢˜ï¼ˆæ–‡æ¡£/æ³¨é‡Šï¼‰

  é—®é¢˜ {index}: {title}

  ä½ç½®: {file}:{line}

  ä¸¥é‡æ€§: ğŸŸ¢ LOW

  é—®é¢˜æè¿°:
  {description}

  å»ºè®®æ”¹è¿›:
  {suggestion}

  ---
  ğŸ“Š è¯¦ç»†åˆ†æ

  ä¸€è‡´æ€§æ£€æŸ¥ç»“æœ

  | æ£€æŸ¥é¡¹       | çŠ¶æ€     | è¯¦æƒ…      |
  |--------------|----------|-----------|
  | æ—¶é—´è½´ä¸€è‡´æ€§ | {status} | {details} |
  | ç‰ˆæœ¬å·ä¸€è‡´æ€§ | {status} | {details} |
  | ä¾èµ–å…³ç³»é—­ç¯ | {status} | {details} |

  å®Œæ•´æ€§æ£€æŸ¥ç»“æœ

  | æ£€æŸ¥é¡¹       | çŠ¶æ€     | è¯¦æƒ…      |
  |--------------|----------|-----------|
  | æµ‹è¯•åœºæ™¯è¦†ç›– | {status} | {details} |
  | é”™è¯¯å¤„ç†è¦†ç›– | {status} | {details} |
  | æ–‡æ¡£å­—æ®µå®ç° | {status} | {details} |

  å¯æ‰§è¡Œæ€§æ¨¡æ‹Ÿç»“æœ

  | æ£€æŸ¥é¡¹       | çŠ¶æ€     | è¯¦æƒ…      |
  |--------------|----------|-----------|
  | ç¬¦å·å¼•ç”¨è§£æ | {status} | {details} |
  | è°ƒç”¨é“¾å¯è¾¾æ€§ | {status} | {details} |
  | æ•°æ®æµéªŒè¯   | {status} | {details} |

  é…ç½®é—­ç¯éªŒè¯ç»“æœ

  | é…ç½®é¡¹     | å®šä¹‰ | å­˜å‚¨ | è¯»å– | å†™å…¥ | UI  | çŠ¶æ€   |
  |------------|------|------|------|------|-----|--------|
  | {config_1} | âœ…   | âœ…   | âŒ   | âŒ   | âš ï¸  | ä¸å®Œæ•´ |
  | {config_2} | âœ…   | âœ…   | âœ…   | âœ…   | âš ï¸  | å®Œæ•´   |

  ---
  ğŸ”„ æ‰§è¡Œå»ºè®®

  å½“å‰çŠ¶æ€

  {status_icon} {status_text}

  ä¿®å¤è·¯å¾„

  1. ç«‹å³ä¿®å¤ (CRITICAL):
    - {fix_1}
    - {fix_2}
  2. å»ºè®®ä¿®å¤ (HIGH):
    - {fix_3}
    - {fix_4}
  3. å¯é€‰ä¿®å¤ (MEDIUM/LOW):
    - {fix_5}
    - {fix_6}

  ä¿®å¤åéªŒè¯

  # é‡æ–°è¿è¡Œåˆ†æ
  /optimize-wave {wave_id}

  # é¢„æœŸç»“æœ
  # ğŸ”´ CRITICAL â†’ 0
  # æ€»ä½“è¯„åˆ† â†’ {target_score}/10

  ---
  ğŸ“š é™„å½•

  A. ç¬¦å·å¼•ç”¨å›¾ (SRG)

  | ç¬¦å·åç§°   | å®šä¹‰ä½ç½®  | å¼•ç”¨æ•°é‡    | å¼•ç”¨è¯¦æƒ… | çŠ¶æ€ |
  |------------|-----------|-------------|----------|------|
  | {symbol_1} | {def}     | {ref_count} | {refs}   | âœ…   |
  | {symbol_2} | âŒ æœªå®šä¹‰ | {ref_count} | {refs}   | ğŸ”´   |

  B. æ•°æ®æµå›¾ (DFG)

  {mermaid_diagram}

  C. å†²çªçŸ©é˜µ

  | å®ä½“       | æ–‡ä»¶ A   | å€¼ A    | æ–‡ä»¶ B   | å€¼ B    | å†²çªç±»å‹ |
  |------------|----------|---------|----------|---------|----------|
  | {entity_1} | {file_a} | {val_a} | {file_b} | {val_b} | {type}   |

  ---
  æŠ¥å‘Šç”Ÿæˆæ—¶é—´: {timestamp}
  åˆ†æè€—æ—¶: {duration}
  ä¸‹æ¬¡å»ºè®®åˆ†ææ—¶é—´: {next_review_time}

  ---

  ### å››ã€æŠ€èƒ½æ‰§è¡Œé€»è¾‘

  #### å…¥å£å‡½æ•°

  ```python
  async def optimize_wave(wave_id: str, project_path: str) -> HealthReport:
      """
      Wave æ·±åº¦é¢„æ‰§è¡Œå®¡æŸ¥ä¸»å‡½æ•°

      Args:
          wave_id: Wave æ ‡è¯†ç¬¦ (å¦‚ "WAVE_2")
          project_path: é¡¹ç›®æ ¹ç›®å½•

      Returns:
          HealthReport: é¢„æ‰§è¡Œå¥åº·æŠ¥å‘Š
      """

      # Phase 1: æ–‡ä»¶ç»“æ„è§£æ
      wave_files = discover_wave_files(wave_id, project_path)

      # Phase 2: å®ä½“æå–
      entities = extract_entities(wave_files)

      # Phase 3: å››ç»´éªŒè¯
      results = {
          "consistency": run_consistency_checks(entities),
          "completeness": run_completeness_checks(entities),
          "executable": run_executable_simulation(entities),
          "configuration": run_configuration_closure(entities)
      }

      # Phase 4: å†²çªåˆ†ç±»ä¸è¯„çº§
      issues = classify_and_rate_issues(results)

      # Phase 5: æŠ¥å‘Šç”Ÿæˆ
      report = generate_health_report(wave_id, issues, results)

      return report

  æ ¸å¿ƒç®—æ³•ç¤ºä¾‹

  def detect_timeline_conflicts(entities: List[Entity]) -> List[Conflict]:
      """
      æ£€æµ‹æ—¶é—´è½´å†²çª
      """
      conflicts = []

      # æŒ‰å®ä½“åˆ†ç»„
      entity_groups = group_by_name(entities)

      for name, group in entity_groups.items():
          origins = extract_origins(group)

          # æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªä¸åŒçš„èµ·æºæ—¶é—´
          unique_origins = set((o.wave, o.version) for o in origins)

          if len(unique_origins) > 1:
              conflicts.append(Conflict(
                  entity=name,
                  conflict_type="æ—¶é—´è½´ä¸ä¸€è‡´",
                  origins=list(unique_origins),
                  severity="CRITICAL",
                  impact="å‰ç½®æ¡ä»¶éªŒè¯å¤±è´¥æˆ–ä¾èµ–é¡ºåºé”™è¯¯"
              ))

      return conflicts

  def detect_coverage_gaps(requirements: List[Requirement], 
                           implementations: List[Implementation]) -> List[Gap]:
      """
      æ£€æµ‹è¦†ç›–é¢ç¼ºå£
      """
      gaps = []

      for req in requirements:
          matched = False

          for impl in implementations:
              if matches_requirement(req, impl):
                  matched = True
                  break

          if not matched:
              gaps.append(Gap(
                  requirement=req,
                  expected_implementation=infer_expected_code(req),
                  severity=estimate_severity(req),
                  suggestion="æ·»åŠ å¯¹åº”çš„å®ç°ä»£ç æˆ–ä»éœ€æ±‚ä¸­ç§»é™¤"
              ))

      return gaps

  def detect_orphan_symbols(srg: SymbolReferenceGraph) -> List[OrphanSymbol]:
      """
      æ£€æµ‹ç¬¦å·å­¤å²›
      """
      orphans = []

      for symbol, info in srg.items():
          if info.definition is None and len(info.references) > 0:
              orphans.append(OrphanSymbol(
                  name=symbol,
                  references=info.references,
                  suggested_location=guess_definition_location(info),
                  suggested_template=generate_template_stub(symbol)
              ))

      return orphans

  ---
  äº”ã€æŠ€èƒ½é…ç½®

  optimize_wave_config:
    # åˆ†ææ·±åº¦
    depth:
      level: "deep"  # shallow | standard | deep
      include_templates: true
      include_dependencies: true

    # ä¸¥é‡æ€§é˜ˆå€¼
    thresholds:
      critical_blocking: true  # CRITICAL é—®é¢˜æ˜¯å¦é˜»æ­¢æ‰§è¡Œ
      high_blocking: false     # HIGH é—®é¢˜æ˜¯å¦é˜»æ­¢æ‰§è¡Œ

    # æŠ¥å‘Šæ ¼å¼
    output:
      format: ["markdown", "json"]
      include_code_examples: true
      include_mermaid_diagrams: true

    # æ€§èƒ½ä¼˜åŒ–
    performance:
      parallel_analysis: true
      cache_results: true
      cache_ttl: 3600  # ç§’

  ---
  å…­ã€ä½¿ç”¨ç¤ºä¾‹

  # åŸºæœ¬ç”¨æ³•
  /optimize-wave WAVE_2

  # æŒ‡å®šé¡¹ç›®è·¯å¾„
  /optimize-wave WAVE_2 --path /path/to/project

  # è¾“å‡º JSON æ ¼å¼
  /optimize-wave WAVE_2 --format json

  # åªæ£€æŸ¥ç‰¹å®šç»´åº¦
  /optimize-wave WAVE_2 --checks consistency,completeness

  # è®¾ç½®ä¸¥é‡æ€§é˜ˆå€¼
  /optimize-wave WAVE_2 --threshold high

  ---
  æ€»ç»“

  è¿™ä»½æ–‡æ¡£è®¾è®¡äº†ä¸€ä¸ªç³»ç»ŸåŒ–çš„Wave é¢„æ‰§è¡Œå®¡æŸ¥å¼•æ“ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š

  1. å››ç»´éªŒè¯æ¡†æ¶ï¼šä¸€è‡´æ€§ã€å®Œæ•´æ€§ã€å¯æ‰§è¡Œæ€§ã€é…ç½®é—­ç¯
  2. æ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºï¼šæ—¶é—´è½´äº¤å‰éªŒè¯ã€è¦†ç›–é¢å¯¹æ¯”ã€ç¬¦å·å¼•ç”¨è¿½è¸ªã€æ•°æ®æµéªŒè¯
  3. æ ‡å‡†åŒ–è¾“å‡ºï¼šç»Ÿä¸€çš„å¥åº·æŠ¥å‘Šæ¨¡æ¿ï¼Œæ¸…æ™°çš„é—®é¢˜åˆ†çº§å’Œä¿®å¤å»ºè®®
  4. å¯é…ç½®æ€§ï¼šæ”¯æŒè°ƒæ•´åˆ†ææ·±åº¦ã€ä¸¥é‡æ€§é˜ˆå€¼ã€è¾“å‡ºæ ¼å¼

  è¿™å¥—æ–¹æ³•è®ºå’ŒæŠ€èƒ½è®¾è®¡å¯ä»¥æœ‰æ•ˆå‘ç° Wave è®¡åˆ’ä¸­çš„é€»è¾‘çŸ›ç›¾ã€å®ç°ç¼ºå£å’Œç¬¦å·å­¤å²›ï¼Œåœ¨æ‰§è¡Œå‰é¿å…æ½œåœ¨é—®é¢˜ã€‚

> ä¿å­˜ä¸ºæ–‡ä»¶ "æ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºä¸ optimize-wave æŠ€èƒ½è®¾è®¡æ–‡æ¡£.md" 

â— Write(docs\æ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºä¸ optimize-wave æŠ€èƒ½è®¾è®¡æ–‡æ¡£.md)
  â¿ Â Wrote 1 lines to docs\æ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºä¸ optimize-wave æŠ€èƒ½è®¾è®¡æ–‡æ¡£.md
     # ğŸ“‹ æ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºä¸ optimize-wave æŠ€èƒ½è®¾è®¡æ–‡æ¡£
     ## ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤ç›˜ä¸æ–¹æ³•è®ºæå–
     ### ä¸€ã€æˆ‘çš„åˆ†ææ€è€ƒè¿‡ç¨‹å¤ç›˜
     #### ğŸ” æ¡ˆä¾‹ç ”ç©¶ 1ï¼šå‘ç° `scan_cache_enabled` é€»è¾‘çŸ›ç›¾
     **æˆ‘çš„æ€è€ƒè·¯å¾„ï¼š**

â— âœ… æ–‡ä»¶å·²æˆåŠŸä¿å­˜ï¼

  æ–‡ä»¶è·¯å¾„: C:\software\full_stack\prism-forge\docs\æ·±åº¦å®¡æŸ¥æ–¹æ³•è®ºä¸ optimize-wave æŠ€èƒ½è®¾è®¡æ–‡æ¡£.md

  æ–‡æ¡£å†…å®¹æ¦‚è¦:

  ğŸ“‹ ç¬¬ä¸€éƒ¨åˆ† - æ·±åº¦å®¡æŸ¥æ–¹æ³•è®º
  - å¤ç›˜äº†ä¸¤ä¸ªå®é™…æ¡ˆä¾‹åˆ†æè¿‡ç¨‹
  - æç‚¼å‡ºå››ç»´äº¤å‰éªŒè¯æ¡†æ¶ï¼š
    - æ—¶é—´è½´äº¤å‰éªŒè¯
    - è¦†ç›–é¢å¯¹æ¯”éªŒè¯
    - ç¬¦å·å¼•ç”¨é“¾è¿½è¸ª
    - æ•°æ®æµè¿ç»­æ€§éªŒè¯
  - æä¾›äº†ç»¼åˆå®¡æŸ¥æµç¨‹å›¾

  ğŸ“‹ ç¬¬äºŒéƒ¨åˆ† - optimize-wave æŠ€èƒ½è®¾è®¡
  - æŠ€èƒ½æ¦‚è¿°å’Œè¾“å…¥è¾“å‡ºå®šä¹‰
  - å››å¤§æ ¸å¿ƒå®¡æŸ¥ç»´åº¦è¯¦ç»†è¯´æ˜
  - æ ‡å‡†åŒ–çš„ã€ŠWave é¢„æ‰§è¡Œå¥åº·æŠ¥å‘Šã€‹æ¨¡æ¿
  - æŠ€èƒ½æ‰§è¡Œé€»è¾‘å’Œæ ¸å¿ƒç®—æ³•ç¤ºä¾‹
  - é…ç½®æ–¹æ¡ˆå’Œä½¿ç”¨ç¤ºä¾‹

  è¿™ä»½æ–‡æ¡£å¯ä»¥ä½œä¸ºåç»­å¼€å‘ optimize-wave æŠ€èƒ½çš„å®Œæ•´è®¾è®¡å‚è€ƒï¼




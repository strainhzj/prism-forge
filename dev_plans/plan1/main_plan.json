{
  "project_name": "Claude Code Session Monitor",
  "document_version": "v1.4",
  "plan_date": "2025-12-30",
  "global_status": {
    "current_phase": "PHASE_2",
    "overall_progress": "52.5%",
    "last_updated": "2026-01-01",
    "blocking_issues": [],
    "completed_waves": [
      "WAVE_1",
      "WAVE_2",
      "WAVE_3",
      "WAVE_4"
    ]
  },
  "git_strategy": {
    "main_branch": "master",
    "feature_branch_template": "feat/{task_id}-wave{wave_number}",
    "commit_message_template": "[{task_id}] {action}: {description}"
  },
  "completed_requirements": [
    "F6.1",
    "F6.2",
    "F6.3",
    "F6.4",
    "F6.5",
    "F3.5"
  ],
  "completed_tasks": [
    "T3_1a",
    "T3_LLM",
    "T2B_1",
    "T1_1",
    "T2_7",
    "T1_3",
    "T1_2",
    "T2_1",
    "T1_PERF",
    "T2_2",
    "T2_3",
    "T2_5",
    "T2B_2",
    "T2B_3",
    "T2_4",
    "T2_6",
    "T3_4",
    "T3_1b",
    "T3_2",
    "T3_3",
    "T3_5",
    "T3_PERF"
  ],
  "phases": [
    {
      "id": "PHASE_1",
      "name": "基础设施与数据持久化层",
      "description": "构建 SQLite 数据库、集成向量扩展，实现会话扫描与存储。",
      "status": "pending",
      "verification_checkpoints": [
        {
          "criteria": "数据库表结构与需求文档 5.2 一致",
          "command": "SELECT name FROM sqlite_master WHERE type='table' ORDER BY name;",
          "expected_output": "api_providers, message_embeddings, messages, meta_templates, saved_prompts, sessions"
        },
        {
          "criteria": "sqlite-vec 扩展已加载",
          "command": "SELECT vec_version();",
          "expected_output": "版本号返回"
        },
        {
          "criteria": "Wave 2 v12 数据库迁移成功，settings 表包含 scan_cache_enabled 字段",
          "command": "PRAGMA table_info(settings);",
          "expected_output": "包含 scan_cache_enabled 列"
        }
      ],
      "tasks": [
        {
          "id": "T1_1",
          "requirement_ref": [
            "F5.1",
            "F5.2"
          ],
          "name": "集成 SQLite 与 sqlite-vec",
          "description": "配置 Rust 依赖 (rusqlite 0.32, sqlite-vec 0.5)，编写 SQL 迁移脚本创建 sessions, messages (轻量化), message_embeddings, saved_prompts, meta_templates 表。",
          "dependencies": [],
          "status": "completed",
          "output_verification": "数据库文件创建成功，且能执行向量距离查询 SQL。",
          "estimated_hours": 20
        },
        {
          "id": "T1_2",
          "requirement_ref": [
            "F1.1",
            "F1.3",
            "F1.4",
            "F5.1"
          ],
          "name": "实现会话扫描器",
          "description": "实现 scanner.rs 扫描 ~/.claude/projects/ 目录。提取会话元数据（session_id, project_path, created_at, updated_at）。实现 F1.4（区分活跃/历史会话：默认 24 小时内为活跃，可通过 settings 配置）。",
          "dependencies": [
            "T1_1"
          ],
          "status": "completed",
          "output_verification": "运行 scan_sessions 命令后，SQLite sessions 表中有数据，is_active 字段正确标识。",
          "estimated_hours": 20
        },
        {
          "id": "T1_3",
          "requirement_ref": [
            "F5.3",
            "F5.4",
            "F6"
          ],
          "name": "扩展数据库表结构",
          "description": "为 sessions 表添加 rating, tags, is_archived 字段（F7）。创建 saved_prompts, meta_templates 表（F9）。api_providers 表已完成（F6），无需修改。",
          "dependencies": [
            "T1_1"
          ],
          "status": "completed",
          "output_verification": "表结构存在，能够插入测试配置数据。",
          "estimated_hours": 10
        },
        {
          "id": "T1_PERF",
          "requirement_ref": [
            "NF1"
          ],
          "name": "性能基准测试 - 启动与扫描",
          "description": "测试启动时间 <3s，会话扫描 <2s（100个会话）。",
          "dependencies": [
            "T1_2"
          ],
          "status": "completed",
          "output_verification": "性能测试报告显示达标。",
          "estimated_hours": 6
        }
      ]
    },
    {
      "id": "PHASE_2",
      "name": "解析引擎与向量嵌入",
      "description": "实现 JSONL 解析、消息树重构、关键信息提取、向量嵌入生成、文件监控。",
      "status": "pending",
      "tasks": [
        {
          "id": "T2_1",
          "requirement_ref": [
            "F2.1",
            "F2.2"
          ],
          "name": "实现 JSONL 流式解析",
          "description": "实现 jsonl.rs 支持增量读取。处理未完成的行缓冲区（FileShare 模式支持）。记录每条消息的 offset 和 length。",
          "dependencies": [
            "T1_2"
          ],
          "status": "completed",
          "output_verification": "能正确解析包含工具调用、错误的各种消息类型。",
          "estimated_hours": 16
        },
        {
          "id": "T2_2",
          "requirement_ref": [
            "F2.2"
          ],
          "name": "消息树构建",
          "description": "基于 parentUuid 重构消息树。实现 tree.rs 构建嵌套 MessageNode 结构。支持深层嵌套（迭代算法防止栈溢出）。",
          "dependencies": [
            "T2_1"
          ],
          "status": "completed",
          "output_verification": "能输出正确的嵌套 MessageNode JSON 结构，根节点为 User 消息。",
          "estimated_hours": 16
        },
        {
          "id": "T2_3",
          "requirement_ref": [
            "F2.3",
            "F2.4"
          ],
          "name": "关键信息提取器",
          "description": "实现 extractor.rs 提取：工具调用序列（tool_use）、错误消息、代码变更（Read/Write 操作）。生成 summary 字段用于列表展示。",
          "dependencies": [
            "T2_2",
            "T1_3"
          ],
          "status": "completed",
          "output_verification": "MessageNode.metadata 包含 toolCalls, errors, codeChanges 数组。",
          "estimated_hours": 14
        },
        {
          "id": "T2_4",
          "requirement_ref": [
            "F2.5"
          ],
          "name": "集成 FastEmbed 生成向量",
          "description": "集成 fastembed 3.3 crate。在解析新消息时，异步生成 summary 的向量（BGE-small-en-v1.5, 384维）并存入 message_embeddings 表。",
          "dependencies": [
            "T1_1",
            "T2_3"
          ],
          "status": "completed",
          "output_verification": "DB 中 message_embeddings 表有 BLOB 数据，能执行距离查询。",
          "estimated_hours": 16
        },
        {
          "id": "T2_5",
          "requirement_ref": [
            "NF2",
            "F2.1"
          ],
          "name": "实现 FileShare 与 Offset 读取",
          "description": "实现 Windows FileShare 读取模式（FILE_SHARE_READ | FILE_SHARE_WRITE）。通过 offset 按需读取完整消息内容。",
          "dependencies": [
            "T2_1"
          ],
          "status": "pending",
          "output_verification": "通过 offset 能从文件准确读取单条 JSON，即使文件被 Claude Code 占用。",
          "estimated_hours": 10
        },
        {
          "id": "T2_6",
          "requirement_ref": [
            "F1.2",
            "F4.4"
          ],
          "name": "实现文件实时监控",
          "description": "使用 notify crate 监控 ~/.claude/projects/ 变更。通过 Tauri Events 推送到前端实现实时更新。事件去重与防抖（2秒延迟）。",
          "dependencies": [
            "T1_2"
          ],
          "status": "completed",
          "output_verification": "Claude Code 创建新会话后，2秒内前端列表自动更新。",
          "estimated_hours": 14
        },
        {
          "id": "T2_7",
          "requirement_ref": [
            "F3.5"
          ],
          "name": "集成 Tiktoken 计数器",
          "description": "集成 tiktoken-rs，实现 count_tokens() 函数和 count_prompt_tokens Tauri Command。",
          "dependencies": [],
          "status": "completed",
          "output_verification": "输入测试文本，返回正确的 Token 数量（与 OpenAI 官方计数一致）。",
          "estimated_hours": 6
        }
      ]
    },
    {
      "id": "PHASE_2B",
      "name": "会话资产管理与增强监控",
      "description": "实现 v1.3 新增的多项目管理、评分标签、归档功能。",
      "status": "pending",
      "tasks": [
        {
          "id": "T2B_1",
          "requirement_ref": [
            "F7.1",
            "F7.2"
          ],
          "name": "实现项目聚合逻辑",
          "description": "扫描 ~/.claude/projects/，按项目路径聚合会话。实现智能上下文切换：点击项目时自动加载该项目的最近活跃会话。",
          "dependencies": [
            "T1_2"
          ],
          "status": "completed",
          "output_verification": "前端侧边栏显示项目文件夹结构，点击项目展开其会话列表。",
          "estimated_hours": 16
        },
        {
          "id": "T2B_2",
          "requirement_ref": [
            "F7.3"
          ],
          "name": "实现会话评分与标签",
          "description": "为 sessions 表添加 rating (1-5) 和 tags (JSON Array) 字段。实现 set_session_rating() 和 set_session_tags() Command。",
          "dependencies": [
            "T1_3"
          ],
          "status": "pending",
          "output_verification": "能对会话进行星级评分和添加标签，数据持久化到数据库。",
          "estimated_hours": 10
        },
        {
          "id": "T2B_3",
          "requirement_ref": [
            "F7.4"
          ],
          "name": "实现归档管理",
          "description": "添加 is_archived 字段。归档会话从活跃列表移除但仍可在搜索索引中找到。实现归档/取消归档 Command。",
          "dependencies": [
            "T1_3"
          ],
          "status": "pending",
          "output_verification": "归档后的会话不在默认列表显示，但可通过搜索找到。",
          "estimated_hours": 6
        }
      ]
    },
    {
      "id": "PHASE_3",
      "name": "核心业务逻辑 (后端)",
      "description": "实现向量检索、上下文压缩、评分加权检索、提示词优化。",
      "status": "pending",
      "tasks": [
        {
          "id": "T3_LLM",
          "requirement_ref": [
            "F6.1",
            "F6.2"
          ],
          "name": "LLM API 管理器",
          "description": "实现 LLMClientManager，集成 keyring 存储 API Key，支持 OpenAI/Anthropic/Ollama/xAI/Google 适配器。（已完成）",
          "dependencies": [],
          "status": "completed",
          "output_verification": "能通过配置的 API Key 成功调用外部 LLM 接口。",
          "estimated_hours": 0
        },
        {
          "id": "T3_1a",
          "requirement_ref": [
            "F3.2"
          ],
          "name": "实现向量相似度检索",
          "description": "编写 sqlite-vec SQL 查询，使用 distance() 函数计算余弦相似度。实现 vector_search() Command 返回 Top-5 相似会话。",
          "dependencies": [
            "T2_4"
          ],
          "status": "pending",
          "output_verification": "输入查询文本，返回最相似的 5 条历史会话，按相似度排序。",
          "estimated_hours": 16
        },
        {
          "id": "T3_1b",
          "requirement_ref": [
            "F3.3",
            "F6.1"
          ],
          "name": "实现评分加权检索 (Weighted RAG)",
          "description": "结合相似度和会话评分的混合排序公式：Score = 0.7*cos_sim + 0.3*(rating/5.0)。高分优质会话优先检索。",
          "dependencies": [
            "T3_1a",
            "T2B_2"
          ],
          "status": "completed",
          "output_verification": "5 星会话在相似度稍低时仍能排在前面。",
          "estimated_hours": 10
        },
        {
          "id": "T3_2",
          "requirement_ref": [
            "F3.3"
          ],
          "name": "实现上下文压缩器",
          "description": "实现 ContextCompressor 去除冗余信息：重复工具调用、中间输出、Thinking 过程。保留关键决策点。",
          "dependencies": [
            "T2_3",
            "T2_7"
          ],
          "status": "pending",
          "output_verification": "压缩后 Token 数减少 >50%，保留关键信息。",
          "estimated_hours": 14
        },
        {
          "id": "T3_3",
          "requirement_ref": [
            "F3.4",
            "F6"
          ],
          "name": "连接优化器与 LLM",
          "description": "将检索到的上下文和压缩后的内容传入 LLMClientManager。完成 optimize_prompt Command，返回 EnhancedPrompt。",
          "dependencies": [
            "T3_1b",
            "T3_2"
          ],
          "status": "pending",
          "output_verification": "完整流程跑通：输入目标 -> 检索 -> 压缩 -> LLM 生成 -> 返回优化提示词。",
          "estimated_hours": 16
        },
        {
          "id": "T3_4",
          "requirement_ref": [
            "F8.1",
            "F8.2"
          ],
          "name": "实现日志提取引擎",
          "description": "实现 ExtractionEngine 支持三级视图：L1 Full Trace（全部内容）、L2 Clean Flow（过滤冗余工具输出）、L3 Prompt Only（仅 QA 对）。支持导出 Markdown/JSON。",
          "dependencies": [
            "T2_3"
          ],
          "status": "completed",
          "output_verification": "能以三种等级提取日志并导出为文件。",
          "estimated_hours": 12
        },
        {
          "id": "T3_5",
          "requirement_ref": [
            "F9.3"
          ],
          "name": "实现 Meta-Prompt 管理",
          "description": "创建 meta_templates 表存储系统提示词。实现 get_meta_template() 和 update_meta_template() Command。",
          "dependencies": [
            "T1_3"
          ],
          "status": "pending",
          "output_verification": "能修改系统的分析和优化 Prompt，立即生效。",
          "estimated_hours": 8
        },
        {
          "id": "T3_PERF",
          "requirement_ref": [
            "NF1"
          ],
          "name": "性能基准测试 - 向量检索",
          "description": "测试 1000+ 会话中检索 Top-5 <100ms。",
          "dependencies": [
            "T3_1a"
          ],
          "status": "pending",
          "output_verification": "性能测试报告显示达标。",
          "estimated_hours": 8
        }
      ]
    },
    {
      "id": "PHASE_4",
      "name": "前端 UI 核心构建",
      "description": "搭建 React 框架，实现会话列表、详情页、项目侧边栏、消息树可视化、设置页。",
      "status": "pending",
      "tasks": [
        {
          "id": "T4_SETUP",
          "requirement_ref": [
            "F4.0"
          ],
          "name": "前端基础框架搭建",
          "description": "安装 shadcn/ui、配置 Tailwind CSS、设置 React Router、创建 Zustand 状态管理、配置 Tanstack Query。",
          "dependencies": [],
          "status": "pending",
          "output_verification": "shadcn/ui 组件正常工作，Tailwind 样式正确应用，路由配置完成，状态管理可用。",
          "estimated_hours": 16
        },
        {
          "id": "T4_1",
          "requirement_ref": [
            "F4.1",
            "F7.1"
          ],
          "name": "会话列表与项目侧边栏",
          "description": "使用 Tanstack Query 调用 scan_sessions。实现项目分组侧边栏（可折叠）。支持搜索、过滤（按项目、标签、评分）。",
          "dependencies": [
            "T4_SETUP",
            "T1_2",
            "T2B_1"
          ],
          "status": "pending",
          "output_verification": "界面显示项目文件夹和会话列表，支持实时搜索。",
          "estimated_hours": 20
        },
        {
          "id": "T4_2",
          "requirement_ref": [
            "F4.2",
            "F8.1"
          ],
          "name": "消息树可视化与懒加载",
          "description": "实现 MessageTree 组件（树状折叠/展开）。点击节点时通过 offset 调用 Tauri 获取完整内容。实现日志等级视图切换（L1/L2/L3）。",
          "dependencies": [
            "T4_SETUP",
            "T2_2",
            "T2_5",
            "T3_4"
          ],
          "status": "pending",
          "output_verification": "点击会话能展示树状结构，展开节点显示详情。视图切换生效。",
          "estimated_hours": 24
        },
        {
          "id": "T4_3",
          "requirement_ref": [
            "F4.6",
            "F3.5"
          ],
          "name": "集成 Token 计数器 UI",
          "description": "封装 TokenCounter 组件，在会话详情和 Prompt Builder 中显示实时 Token 数和估算费用。",
          "dependencies": [
            "T2_7",
            "T4_2"
          ],
          "status": "pending",
          "output_verification": "界面显示 Token 数和金额，实时更新。",
          "estimated_hours": 8
        },
        {
          "id": "T4_4",
          "requirement_ref": [
            "F4.4"
          ],
          "name": "实现实时更新指示器",
          "description": "监听 Tauri Events，当检测到文件变更时显示加载动画，2秒后自动刷新列表。",
          "dependencies": [
            "T2_6",
            "T4_1"
          ],
          "status": "pending",
          "output_verification": "Claude Code 写入新消息后，前端自动显示新内容。",
          "estimated_hours": 10
        },
        {
          "id": "T4_5",
          "requirement_ref": [
            "F7.3"
          ],
          "name": "会话评分与标签 UI",
          "description": "在会话详情页添加星级评分组件和标签编辑器。支持快捷键操作（1-5 键打分）。",
          "dependencies": [
            "T2B_2",
            "T4_2"
          ],
          "status": "pending",
          "output_verification": "能对会话进行打分和标签管理，数据同步到后端。",
          "estimated_hours": 12
        },
        {
          "id": "T4_6",
          "requirement_ref": [
            "F6.3",
            "F6.5"
          ],
          "name": "设置页面与 API 配置",
          "description": "实现 LLM Provider 配置表单。支持连通性测试按钮、模型下拉选择、Temperature/Max Tokens 滑块。（ProviderForm.tsx 已完成，需集成到设置页）",
          "dependencies": [
            "T3_LLM",
            "T4_1"
          ],
          "status": "pending",
          "output_verification": "能在前端保存 API Key 并通过测试按钮验证连接。",
          "estimated_hours": 14
        }
      ]
    },
    {
      "id": "PHASE_5",
      "name": "UI 增强与高级功能",
      "description": "实现代码 Diff、提示词实验室、导出功能。",
      "status": "pending",
      "tasks": [
        {
          "id": "T5_1a",
          "requirement_ref": [
            "F4.5"
          ],
          "name": "集成 Monaco Editor 基础",
          "description": "引入 @monaco-editor/react，配置 TypeScript 语法高亮和主题（深色模式）。",
          "dependencies": [
            "T4_2"
          ],
          "status": "pending",
          "output_verification": "消息中的代码块支持语法高亮和行号。",
          "estimated_hours": 8
        },
        {
          "id": "T5_1b",
          "requirement_ref": [
            "F4.5"
          ],
          "name": "实现代码变更检测",
          "description": "解析 Write/Edit 工具调用，提取 oldText 和 newText 对。存储在 MessageNode.metadata.codeChanges 中。",
          "dependencies": [
            "T2_3"
          ],
          "status": "pending",
          "output_verification": "能正确识别代码变更并提取新旧代码。",
          "estimated_hours": 8
        },
        {
          "id": "T5_1c",
          "requirement_ref": [
            "F4.5"
          ],
          "name": "实现 Diff 视图渲染",
          "description": "引入 react-diff-viewer-continued，实现代码对比组件。支持并排/统一模式切换。需验证大文件（>1000 行）Diff 渲染性能。",
          "dependencies": [
            "T5_1a",
            "T5_1b"
          ],
          "status": "pending",
          "output_verification": "消息中的代码变更支持高亮 Diff 对比，大文件无明显卡顿。",
          "estimated_hours": 12
        },
        {
          "id": "T5_2",
          "requirement_ref": [
            "F4.3",
            "F9"
          ],
          "name": "提示词实验室 UI",
          "description": "实现 Prompt Builder 界面：目标输入框、会话选择器、生成按钮、结果预览、Token 统计、复制/保存按钮。调用 optimize_prompt 接口。",
          "dependencies": [
            "T3_3",
            "T4_3"
          ],
          "status": "pending",
          "output_verification": "能生成提示词并显示节省的 Token 百分比。",
          "estimated_hours": 18
        },
        {
          "id": "T5_3",
          "requirement_ref": [
            "F9.1",
            "F9.2"
          ],
          "name": "提示词库管理 UI",
          "description": "实现三栏布局：Next Goals / AI Analysis / Meta Templates。支持搜索、筛选、评分、编辑、删除。",
          "dependencies": [
            "T3_5"
          ],
          "status": "pending",
          "output_verification": "能管理所有生成的提示词和 Meta Template。",
          "estimated_hours": 14
        },
        {
          "id": "T5_4",
          "requirement_ref": [
            "F5.4",
            "F8.2"
          ],
          "name": "实现数据导出功能",
          "description": "实现 export_session Command 支持 JSON/CSV/Markdown 格式。前端添加导出按钮和格式选择器。",
          "dependencies": [
            "T3_4"
          ],
          "status": "pending",
          "output_verification": "能导出单条会话或批量导出为指定格式文件。",
          "estimated_hours": 8
        },
        {
          "id": "T5_5",
          "requirement_ref": [
            "F7.4"
          ],
          "name": "归档管理 UI",
          "description": "在会话列表添加归档/取消归档按钮。归档会话移至单独的「已归档」标签页。",
          "dependencies": [
            "T2B_3",
            "T4_1"
          ],
          "status": "pending",
          "output_verification": "归档会话不在主列表显示，可在归档页查看。",
          "estimated_hours": 6
        }
      ]
    },
    {
      "id": "PHASE_6",
      "name": "测试、优化与发布",
      "description": "端到端测试、性能优化、打包发布。",
      "status": "pending",
      "tasks": [
        {
          "id": "T6_1",
          "requirement_ref": [
            "NF1",
            "NF2"
          ],
          "name": "端到端测试",
          "description": "编写完整的 E2E 测试覆盖核心流程：扫描 -> 检索 -> 优化 -> 导出。",
          "dependencies": [
            "T5_5"
          ],
          "status": "pending",
          "output_verification": "所有核心功能测试通过。",
          "estimated_hours": 20
        },
        {
          "id": "T6_2",
          "requirement_ref": [
            "NF1"
          ],
          "name": "性能优化",
          "description": "优化向量检索索引、消息树构建算法、前端渲染性能。确保符合所有 NF1 性能指标。",
          "dependencies": [
            "T6_1"
          ],
          "status": "pending",
          "output_verification": "性能测试报告全部达标。",
          "estimated_hours": 16
        },
        {
          "id": "T6_3",
          "requirement_ref": [],
          "name": "Windows 打包与签名",
          "description": "使用 Tauri Bundler 构建 Windows 安装包。配置代码签名证书（如可用）。",
          "dependencies": [
            "T6_2"
          ],
          "status": "pending",
          "output_verification": "生成 .msi 或 .exe 安装包，体积 <15MB。",
          "estimated_hours": 12
        },
        {
          "id": "T6_4",
          "requirement_ref": [],
          "name": "文档与发布",
          "description": "编写用户手册、API 文档、README。创建 GitHub Release。",
          "dependencies": [
            "T6_3"
          ],
          "status": "pending",
          "output_verification": "文档完整，正式发布 v1.0.0。",
          "estimated_hours": 16
        },
        {
          "id": "T6_PERF_FRONTEND",
          "requirement_ref": [
            "NF1"
          ],
          "name": "前端性能基准测试",
          "description": "测试前端核心场景性能：会话列表渲染（1000+项）<500ms，消息树展开/折叠 <100ms，代码 Diff 渲染（1000+行）<1s。使用 Lighthouse CI 自动化测试。",
          "dependencies": [
            "T4_2",
            "T5_1c"
          ],
          "status": "pending",
          "output_verification": "Lighthouse 性能报告显示所有指标达标。",
          "estimated_hours": 10
        }
      ]
    }
  ],
  "execution_guidelines": {
    "start_command": "git checkout -b {branch_name}",
    "finish_command": "git add . && git commit -m \"{commit_message}\" && git checkout {main_branch} && git merge {branch_name}",
    "interruption_handling": "确保修改 task status 为 'in_progress' 或 'completed' 后保存文件",
    "verification_before_phase": "每个 Phase 开始前确保 verification_checkpoints 全部通过",
    "status_values": [
      "pending",
      "in_progress",
      "completed",
      "blocked"
    ],
    "priority_weights": {
      "critical": [
        "T1_1",
        "T1_2",
        "T2_1",
        "T2_2",
        "T3_3",
        "T4_SETUP"
      ],
      "high": [
        "T2_3",
        "T2_4",
        "T2_5",
        "T2B_1",
        "T2B_2",
        "T3_1a",
        "T4_1",
        "T4_2"
      ],
      "medium": [
        "T2B_3",
        "T5_2",
        "T4_6"
      ],
      "low": [
        "T5_1",
        "T6_4"
      ]
    },
    "dev_notes": [
      "T4_6 (设置页面) 应尽早完成，方便开发调试 LLM 功能",
      "PHASE_2B 和 PHASE_4 可并行开发：后端准备聚合 API，前端实现列表 UI",
      "T5_1c 需特别注意大文件 Diff 性能，必要时使用虚拟滚动"
    ],
    "wave_plan_paths": {
      "description": "详细的子计划按执行顺序（Waves）组织，每波包含具体的验收标准和分支策略",
      "waves_directory": "waves/",
      "wave_plans": [
        {
          "wave_id": "WAVE_1",
          "name": "第一波：无依赖任务启动",
          "file": "waves/wave1_database.json",
          "covers_phases": [
            "PHASE_1 (部分)",
            "PHASE_2 (部分)",
            "PHASE_3 (部分)"
          ],
          "tasks": [
            "T1_1",
            "T2_7"
          ],
          "description": "启动项目基础建设，包含无外部依赖的三个核心任务"
        },
        {
          "wave_id": "WAVE_2",
          "name": "第二波：PHASE_1 核心任务",
          "file": "waves/wave2_phase1_core.json",
          "covers_phases": [
            "PHASE_1"
          ],
          "tasks": [
            "T1_2",
            "T1_3",
            "T1_PERF"
          ],
          "description": "完成会话扫描器和表结构扩展，实现基础的会话发现功能"
        },
        {
          "wave_id": "WAVE_3",
          "name": "第三波：PHASE_2 解析引擎与 PHASE_2B",
          "file": "waves/wave3_phase2_parser.json",
          "covers_phases": [
            "PHASE_2",
            "PHASE_2B"
          ],
          "tasks": [
            "T2_1",
            "T2_2",
            "T2_3",
            "T2_5",
            "T2B_1",
            "T2B_2",
            "T2B_3"
          ],
          "description": "实现 JSONL 解析、消息树重构、关键信息提取、FileShare 读取，以及多项目管理、评分标签、归档功能（向量嵌入 T2_4 在 WAVE_4 实现）",
          "depends_on": [
            "WAVE_2"
          ]
        },
        {
          "wave_id": "WAVE_4",
          "name": "第四波：PHASE_2 剩余任务",
          "file": "waves/wave4_phase2_remaining.json",
          "covers_phases": [
            "PHASE_2",
            "PHASE_3 (部分)"
          ],
          "tasks": [
            "T2_4",
            "T2_6",
            "T3_4"
          ],
          "description": "完成向量嵌入生成、文件监控、以及日志提取引擎"
        },
        {
          "wave_id": "WAVE_5",
          "name": "第五波：PHASE_3 核心业务逻辑",
          "file": "waves/wave5_phase3_business.json",
          "covers_phases": [
            "PHASE_3"
          ],
          "tasks": [
            "T3_1a",
            "T3_1b",
            "T3_2",
            "T3_3",
            "T3_PERF",
            "T3_5"
          ],
          "description": "实现向量检索、上下文压缩、评分加权检索、提示词优化，以及 Meta-Prompt 管理"
        },
        {
          "wave_id": "WAVE_6",
          "name": "第六波：PHASE_4 前端 UI 核心",
          "file": "waves/wave6_phase4_frontend.json",
          "covers_phases": [
            "PHASE_4"
          ],
          "tasks": [
            "T4_SETUP",
            "T4_1",
            "T4_2",
            "T4_3",
            "T4_4",
            "T4_5",
            "T4_6"
          ],
          "description": "搭建 React 框架、shadcn/ui、实现会话列表、详情页、消息树可视化"
        },
        {
          "wave_id": "WAVE_7",
          "name": "第七波：PHASE_5 UI 增强与 PHASE_6 测试发布",
          "file": "waves/wave7_phase5_6.json",
          "covers_phases": [
            "PHASE_5",
            "PHASE_6"
          ],
          "tasks": [
            "T5_1a",
            "T5_1b",
            "T5_1c",
            "T5_2",
            "T5_3",
            "T5_4",
            "T5_5",
            "T6_PERF_FRONTEND",
            "T6_1",
            "T6_2",
            "T6_3",
            "T6_4"
          ],
          "description": "实现代码 Diff、提示词实验室、导出功能，以及测试与发布"
        }
      ]
    }
  },
  "change_log": [
    {
      "date": "2025-12-28",
      "version": "1.4",
      "changes": [
        "修正 completed_requirements 为实际完成的 F6 系列需求",
        "添加 T3_LLM 到 completed_tasks（LLM API 管理器已实现）",
        "新增 PHASE_2B 会话资产管理模块（F7 需求）",
        "新增 T2_6 文件实时监控任务",
        "新增 T2_7 Tiktoken 计数器任务",
        "新增 T3_1b 评分加权检索 (Weighted RAG)",
        "新增 T3_4 日志提取引擎 (F8)",
        "新增 T3_5 Meta-Prompt 管理 (F9.3)",
        "新增 T4_4 实时更新指示器",
        "新增 T4_5 评分标签 UI",
        "新增 T4_6 设置页面（移至 PHASE_4，依赖 T3_LLM 和 T4_1）",
        "拆分 T5_1 为 Monaco 集成的三个子任务",
        "新增 T5_3 提示词库管理 UI",
        "新增 T5_4 数据导出功能（原 T5_5 改为 T5_4）",
        "新增 T5_5 归档管理 UI（原 T5_6 改为 T5_5）",
        "新增 PHASE_6 测试与发布阶段",
        "添加 verification_checkpoints 和性能测试任务",
        "完善依赖关系，修正 T5_4 依赖倒置问题",
        "更新 git_strategy main_branch 为 master",
        "添加 priority_weights, status_values, dev_notes",
        "T1_2 活跃判断改为可配置（默认 24h）",
        "T5_1c 增加大文件性能验证点",
        "清空 blocking_issues"
      ]
    },
    {
      "date": "2025-12-30",
      "version": "1.4",
      "changes": [
        "主计划审计修复（第1轮）：修复 P0-001/002/003（T1_2 依赖、T3_LLM 状态、Wave 3 Git 策略）",
        "主计划审计修复（第2轮）：健康分从 6.5/10 提升至 9.3/10，审计通过",
        "主计划审计修复（第3轮）：修复 P1 文档一致性问题（T3_5 位置、WAVE_1 任务列表、Wave 3 tasks 数组）",
        "Wave 文件审计修复：重命名 4 个 .txt 文件为 .json（Wave 4-7）",
        "Wave 7 并行组矛盾修复：将 GROUP_B parallel_with 改为 sequential_after",
        "添加 estimated_hours 到所有任务（40个任务）",
        "添加 v12 数据库验证点到 PHASE_1 verification_checkpoints",
        "更新 WAVE_5 任务列表包含 T3_5 和 T3_PERF",
        "修正 wave1 中 T3_5 的 moved_to 描述为 Wave 5",
        "同步 main_plan 中 WAVE_1 任务列表移除 T3_5",
        "为 Wave 3 添加完整的 tasks 数组（7个任务）",
        "Wave 1 JSON 格式修复：修正 _version_history 格式问题"
      ]
    },
    {
      "date": "2025-12-31",
      "version": "1.5",
      "changes": [
        "Wave 3 完成：实现 PHASE_2 解析引擎与 PHASE_2B 会话资产管理",
        "T2_1: JSONL 流式解析器，支持增量读取和 offset 记录",
        "T2_2: 消息树构建器，使用迭代算法避免栈溢出",
        "T2_3: 关键信息提取器，提取工具调用、错误、代码变更、摘要",
        "T2_5: FileShare 与 Offset 读取（在 T2_1 中实现）",
        "T2B_1: 项目聚合逻辑，按项目路径聚合会话",
        "T2B_2: 会话评分与标签系统，支持 1-5 星评分和标签管理",
        "T2B_3: 归档管理功能，支持归档/取消归档和列表查询",
        "新增文件：parser/extractor.rs, parser/tree.rs, parser/jsonl.rs",
        "新增 Tauri 命令：set_session_rating, set_session_tags, get_session_rating, get_session_tags",
        "新增 Tauri 命令：archive_session, unarchive_session, get_archived_sessions, get_active_sessions",
        "数据库扩展：SessionRepository 新增 8 个方法（评分、标签、归档相关）",
        "整体进度更新：19.5% 完成，WAVE_1/2/3 全部完成"
      ]
    },
    {
      "date": "2026-01-01",
      "version": "1.6",
      "changes": [
        "Wave 4 完成：实现向量嵌入生成、文件实时监控、日志提取引擎",
        "T2_3: 关键信息提取器（MetadataExtractor），提取工具调用、错误、代码变更、摘要",
        "T2_4: 集成 FastEmbed 生成向量（EmbeddingGenerator），Windows 使用占位符实现",
        "T2_6: 文件实时监控（SessionWatcher），使用 notify crate，2秒防抖延迟",
        "T3_4: 日志提取引擎（ExtractionEngine），支持 L1/L2/L3 三级视图和 Markdown/JSON 导出",
        "新增文件：embedding/mod.rs, embedding/generator.rs, monitor/watcher.rs",
        "新增 Tauri 命令：start_file_watcher, extract_session_log, export_session_log",
        "新增数据库方法：save_message_embedding, save_message_embeddings_batch, get_message_embedding, vector_search",
        "整体进度更新：52.5% 完成（21/40 任务），WAVE_1/2/3/4 全部完成"
      ]
    }
  ]
}
{
  "_file_type": "code_templates_ref",
  "_description": "Wave 1 代码模板资源引用",
  "_note": "所有代码模板已提取到资源文件 dev_plans/plan1/resources/wave1/database/03_code_templates.md，实现代码示例与任务命令的解耦。",
  "_metadata": {
    "extraction_date": "2025-12-29",
    "last_verified": "v1.11",
    "total_templates": 11
  },
  "_critical_reminder": {
    "title": "⚠️ 执行前必读",
    "priority": "HIGHEST",
    "message": "本文件仅包含资源引用，实际代码模板位于外部文件。执行任何代码修改前，必须先阅读以下资源文件：",
    "required_reading": [
      {
        "file": "dev_plans/plan1/resources/wave1/database/03_code_templates.md",
        "when_to_read": "在执行 wave1.2_task_t1_1.json 和 wave1.3_task_t2_7.json 中的任何代码编写步骤之前",
        "contains": "11 个完整的代码模板（init.rs, lib.rs, Repository, 测试等）"
      },
      {
        "file": "dev_plans/plan1/resources/wave1/database/01_complete_schema_ddl.sql",
        "when_to_read": "在执行 T1_1 Step 3（编写迁移脚本）之前",
        "contains": "完整的数据库 DDL（v4-v8 迁移的 SQL 语句）"
      },
      {
        "file": "dev_plans/plan1/resources/wave1/tokenizer/01_tokenizer_design.md",
        "when_to_read": "在执行 T2_7 Step 2（实现 tokenizer 模块）之前",
        "contains": "Tokenizer 完整实现代码（模型匹配逻辑、测试用例）"
      }
    ],
    "quick_reference": {
      "template_mapping": {
        "init.rs 完整实现": "03_code_templates.md → init_rs_complete_template",
        "lib.rs 集成代码": "03_code_templates.md → lib_rs_integration",
        "Repository CRUD": "03_code_templates.md → session_repository_template",
        "向量搜索实现": "03_code_templates.md → vector_search_template",
        "并发测试": "03_code_templates.md → concurrent_test_template",
        "Tokenizer 模型匹配": "tokenizer/01_tokenizer_design.md → complete implementation"
      }
    }
  },
  "resource_reference": {
    "file": "dev_plans/plan1/resources/wave1/database/03_code_templates.md",
    "description": "完整的 Wave 1 代码模板集合，涵盖 11 个主要模块",
    "templates_included": [
      "1. 模块声明 (mod.rs 导出)",
      "2. 数据库初始化 (init.rs 完整实现)",
      "3. Tauri 集成 (lib.rs 完整集成)",
      "4. 数据模型 (Session, MessageEmbedding)",
      "5. Repository CRUD (SessionRepository 模板)",
      "6. 向量搜索 (MessageEmbeddingRepository 完整实现)",
      "7. 错误处理 (Repository 和 lib.rs 错误处理模式)",
      "8. 测试辅助 (测试数据库设置和函数可见性)",
      "9. 并发测试 (并发创建、读写测试完整示例)",
      "10. Tokenizer 实现 (模型匹配逻辑)",
      "11. Breaking Change 适配 (LLMClientManager 和 Command 更新)"
    ],
    "usage_note": "执行任何代码修改前，请先阅读 dev_plans/plan1/resources/wave1/database/03_code_templates.md"
  },
  "key_templates": {
    "module_declaration": "模块导出声明 (pub mod + pub use)",
    "init_rs": "完整 init.rs 实现 (OnceLock + Arc<Mutex<>>)",
    "lib_rs": "Tauri 集成 (数据库初始化 + 状态管理)",
    "repository_crud": "SessionRepository CRUD (with_conn + create + update)",
    "vector_search": "MessageEmbeddingRepository (insert + search_similar)",
    "concurrent_tests": "并发测试完整示例 (10 线程并发)",
    "tokenizer": "Token 计数器模型匹配逻辑",
    "breaking_change": "LLMClientManager 适配 Arc<Mutex<Connection>>"
  },
  "usage_note": "执行任何代码修改前，请先阅读 dev_plans/plan1/resources/wave1/database/03_code_templates.md",
  "features": {
    "arc_mutex_support": "✅ 完整支持 Arc<Mutex<Connection>>",
    "concurrent_tests": "✅ 包含完整并发测试示例",
    "breaking_change_handling": "✅ Breaking Change 处理说明",
    "error_handling": "✅ .map_err() 错误处理模式",
    "code_style": "✅ 遵循项目代码风格（中文注释、snake_case）"
  }
}

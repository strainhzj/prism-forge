{
  "_file_type": "wave_manifest",
  "_description": "Wave 1 主指引文件：指向所有子任务文件",
  "_version": "v1.8.1",
  "_version_description": "非破坏性修复：解决 P1 和 P2 问题（TokenStats 缺失、测试迁移未显式化、LLMClientManager 验收、资源文件交叉引用）",
  "wave_id": "WAVE_1",
  "name": "第一波：数据库基石",
  "description": "建立项目数据持久化基础，包含 SQLite 数据库扩展、向量嵌入支持和 Token 计数功能",
  "branch": {
    "name": "feat/phase1-wave1",
    "base": "master",
    "strategy": "feature_branch"
  },
  "_agent_instructions": {
    "execution_order": [
      "1. 首先阅读 wave1.1_metadata.json 了解项目元数据和关键决策",
      "2. 根据 wave1.2_task_t1_1.json 执行 T1_1 任务（数据库集成）",
      "3. 根据 wave1.3_task_t2_7.json 执行 T2_7 任务（Token 计数器）",
      "4. 参考 wave1.5_templates.json 实现具体代码模板",
      "5. 根据 wave1.4_integration.json 执行集成测试和验证",
      "6. 参考 wave1.6_strategy.json 处理 Git 策略和风险"
    ],
    "required_reading_files": [
      "wave1.1_metadata.json",
      "wave1.2_task_t1_1.json",
      "wave1.3_task_t2_7.json",
      "wave1.4_integration.json",
      "wave1.5_templates.json",
      "wave1.6_strategy.json"
    ],
    "external_resources": [
      "dev_plans/plan1/resources/wave1/README.md",
      "dev_plans/plan1/resources/wave1/database/01_complete_schema_ddl.sql",
      "dev_plans/plan1/resources/wave1/database/02_init_design.md"
    ]
  },
  "_file_structure": {
    "wave1_database.json": "主指引文件（本文件）",
    "wave1.1_metadata.json": "元数据：版本历史、Agent 指令、文件操作、基本信息",
    "wave1.2_task_t1_1.json": "任务 T1_1：集成 SQLite 与 sqlite-vec（完整实现步骤）",
    "wave1.3_task_t2_7.json": "任务 T2_7：集成 Tiktoken 计数器（完整实现步骤）",
    "wave1.4_integration.json": "集成指南：集成任务、验证检查点、回滚计划、API 兼容性",
    "wave1.5_templates.json": "代码模板：模块声明、初始化、错误处理、测试辅助等模板",
    "wave1.6_strategy.json": "策略指南：Git 策略、风险缓解、交付物"
  },
  "parallel_tasks": [
    {
      "task_id": "T1_1",
      "name": "集成 SQLite 与 sqlite-vec",
      "sub_branch": "feat/phase1-wave1-t1_1",
      "file_reference": "wave1.2_task_t1_1.json",
      "estimated_hours": 20,
      "priority": "critical",
      "dependencies": []
    },
    {
      "task_id": "T2_7",
      "name": "集成 Tiktoken 计数器",
      "sub_branch": "feat/phase1-wave1-t2_7",
      "file_reference": "wave1.3_task_t2_7.json",
      "estimated_hours": 6,
      "priority": "high",
      "dependencies": []
    }
  ],
  "removed_tasks": [
    {
      "task_id": "T3_5",
      "name": "实现 Meta-Prompt 管理",
      "reason": "本阶段仅定义 MetaTemplate 数据模型，完整的 CRUD 操作和 Tauri 命令延后到 Wave 5 实现",
      "moved_to": "Wave 5 (PHASE_3 核心业务逻辑)"
    }
  ],
  "_quick_reference": {
    "database_versions": "v0-v8 (参考 wave1.1_metadata.json)",
    "acceptance_criteria": "参考 wave1.2_task_t1_1.json 和 wave1.3_task_t2_7.json",
    "verification_checkpoints": "参考 wave1.4_integration.json",
    "rollback_plan": "参考 wave1.4_integration.json",
    "code_templates": "参考 wave1.5_templates.json",
    "git_strategy": "参考 wave1.6_strategy.json"
  },
  "success_criteria": [
    "所有 7 张表正确创建（api_providers + 6 张新表）",
    "sqlite-vec 扩展加载成功，SELECT vec_version() 返回 0.5.0",
    "向量距离查询功能正常工作",
    "Token 计数器支持 GPT/Claude 模型",
    "所有单元测试通过（覆盖率 > 80%）",
    "并发访问测试通过（无死锁）",
    "集成测试验证通过",
    "main_plan.json 状态已同步更新（completed_tasks, global_status）"
  ],
  "_backup_info": {
    "original_file_backup": "wave1_database.json.backup",
    "backup_date": "2025-12-29",
    "reason": "原文件长度约 38000 字符，已拆分为 7 个子文件便于 Claude Code 处理"
  },
  "_version_history": {
    "v1.0": "初始版本",
    "v1.8": "拆分为多个子文件，添加资源文件引用",
    "v1.8.1": "非破坏性修复（2025-12-30）：P1 修复 1-2, P2 修复 1-2 (详情见变更日志)"
  }
}